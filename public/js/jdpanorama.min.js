!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.VRView=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module){function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}var gen=fn.apply(self,args);_next(void 0)})}}module.exports=_asyncToGenerator},{}],2:[function(_dereq_,module){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}module.exports=_interopRequireDefault},{}],3:[function(_dereq_,module){function _typeof(obj){"@babel/helpers - typeof";return module.exports=_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}module.exports=_typeof},{}],4:[function(_dereq_,module){var runtime=function(exports){"use strict";function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=makeInvokeMethod(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}function AsyncIterator(generator,PromiseImpl){function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if("throw"!==record.type){var result=record.arg,value=result.value;return value&&"object"==typeof value&&hasOwn.call(value,"__await")?PromiseImpl.resolve(value.__await).then(function(value){invoke("next",value,resolve,reject)},function(err){invoke("throw",err,resolve,reject)}):PromiseImpl.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},function(error){return invoke("throw",error,resolve,reject)})}reject(record.arg)}function enqueue(method,arg){function callInvokeWithMethodAndArg(){return new PromiseImpl(function(resolve,reject){invoke(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}var previousPromise;this._invoke=enqueue}function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted){if("throw"===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if("next"===context.method)context.sent=context._sent=context.arg;else if("throw"===context.method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,context.arg;context.dispatchException(context.arg)}else"return"===context.method&&context.abrupt("return",context.arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if("normal"===record.type){if(state=context.done?GenStateCompleted:GenStateSuspendedYield,record.arg===ContinueSentinel)continue;return{value:record.arg,done:context.done}}"throw"===record.type&&(state=GenStateCompleted,context.method="throw",context.arg=record.arg)}}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){if(context.delegate=null,"throw"===context.method){if(delegate.iterator["return"]&&(context.method="return",context.arg=undefined,maybeInvokeDelegate(delegate,context),"throw"===context.method))return ContinueSentinel;context.method="throw",context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if("throw"===record.type)return context.method="throw",context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,"return"!==context.method&&(context.method="next",context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method="throw",context.arg=new TypeError("iterator result is not an object"),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}var undefined,Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol="function"==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||"@@iterator",asyncIteratorSymbol=$Symbol.asyncIterator||"@@asyncIterator",toStringTagSymbol=$Symbol.toStringTag||"@@toStringTag";exports.wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={},IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);return GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName="GeneratorFunction",exports.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return ctor?ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name):!1},exports.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,toStringTagSymbol in genFun||(genFun[toStringTagSymbol]="GeneratorFunction")),genFun.prototype=Object.create(Gp),genFun},exports.awrap=function(arg){return{__await:arg}},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this},exports.AsyncIterator=AsyncIterator,exports.async=function(innerFn,outerFn,self,tryLocsList,PromiseImpl){void 0===PromiseImpl&&(PromiseImpl=Promise);var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList),PromiseImpl);return exports.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),Gp[toStringTagSymbol]="Generator",Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},exports.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},exports.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootEntry=this.tryEntries[0],rootRecord=rootEntry.completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,caught&&(context.method="next",context.arg=undefined),!!caught}if(this.done)throw exception;for(var context=this,i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method="next",this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;return"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=this.arg=record.arg,this.method="return",this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},"next"===this.method&&(this.arg=undefined),ContinueSentinel}},exports}("object"==typeof module?module.exports:{});try{regeneratorRuntime=runtime}catch(accidentalStrictMode){Function("r","regeneratorRuntime = r")(runtime)}},{}],5:[function(_dereq_,module){module.exports=_dereq_("regenerator-runtime")},{"regenerator-runtime":4}],6:[function(_dereq_,module,exports){(function(process,global){!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.ES6Promise=factory()}(this,function(){"use strict";function objectOrFunction(x){return"function"==typeof x||"object"==typeof x&&null!==x}function isFunction(x){return"function"==typeof x}function setScheduler(scheduleFn){customSchedulerFn=scheduleFn}function setAsap(asapFn){asap=asapFn}function useNextTick(){return function(){return process.nextTick(flush)}}function useVertxTimer(){return function(){vertxNext(flush)}}function useMutationObserver(){var iterations=0,observer=new BrowserMutationObserver(flush),node=document.createTextNode("");return observer.observe(node,{characterData:!0}),function(){node.data=iterations=++iterations%2}}function useMessageChannel(){var channel=new MessageChannel;return channel.port1.onmessage=flush,function(){return channel.port2.postMessage(0)}}function useSetTimeout(){var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1)}}function flush(){for(var i=0;len>i;i+=2){var callback=queue[i],arg=queue[i+1];callback(arg),queue[i]=void 0,queue[i+1]=void 0}len=0}function attemptVertx(){try{var r=_dereq_,vertx=r("vertx");return vertxNext=vertx.runOnLoop||vertx.runOnContext,useVertxTimer()}catch(e){return useSetTimeout()}}function then(onFulfillment,onRejection){var _arguments=arguments,parent=this,child=new this.constructor(noop);void 0===child[PROMISE_ID]&&makePromise(child);var _state=parent._state;return _state?!function(){var callback=_arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result)})}():subscribe(parent,child,onFulfillment,onRejection),child}function resolve(object){var Constructor=this;if(object&&"object"==typeof object&&object.constructor===Constructor)return object;var promise=new Constructor(noop);return _resolve(promise,object),promise}function noop(){}function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function getThen(promise){try{return promise.then}catch(error){return GET_THEN_ERROR.error=error,GET_THEN_ERROR}}function tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function handleForeignThenable(promise,thenable,then){asap(function(promise){var sealed=!1,error=tryThen(then,thenable,function(value){sealed||(sealed=!0,thenable!==value?_resolve(promise,value):fulfill(promise,value))},function(reason){sealed||(sealed=!0,_reject(promise,reason))},"Settle: "+(promise._label||" unknown promise"));!sealed&&error&&(sealed=!0,_reject(promise,error))},promise)}function handleOwnThenable(promise,thenable){thenable._state===FULFILLED?fulfill(promise,thenable._result):thenable._state===REJECTED?_reject(promise,thenable._result):subscribe(thenable,void 0,function(value){return _resolve(promise,value)},function(reason){return _reject(promise,reason)})}function handleMaybeThenable(promise,maybeThenable,then$$){maybeThenable.constructor===promise.constructor&&then$$===then&&maybeThenable.constructor.resolve===resolve?handleOwnThenable(promise,maybeThenable):then$$===GET_THEN_ERROR?_reject(promise,GET_THEN_ERROR.error):void 0===then$$?fulfill(promise,maybeThenable):isFunction(then$$)?handleForeignThenable(promise,maybeThenable,then$$):fulfill(promise,maybeThenable)}function _resolve(promise,value){promise===value?_reject(promise,selfFulfillment()):objectOrFunction(value)?handleMaybeThenable(promise,value,getThen(value)):fulfill(promise,value)}function publishRejection(promise){promise._onerror&&promise._onerror(promise._result),publish(promise)}function fulfill(promise,value){promise._state===PENDING&&(promise._result=value,promise._state=FULFILLED,0!==promise._subscribers.length&&asap(publish,promise))}function _reject(promise,reason){promise._state===PENDING&&(promise._state=REJECTED,promise._result=reason,asap(publishRejection,promise))}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers,length=_subscribers.length;parent._onerror=null,_subscribers[length]=child,_subscribers[length+FULFILLED]=onFulfillment,_subscribers[length+REJECTED]=onRejection,0===length&&parent._state&&asap(publish,parent)}function publish(promise){var subscribers=promise._subscribers,settled=promise._state;if(0!==subscribers.length){for(var child=void 0,callback=void 0,detail=promise._result,i=0;i<subscribers.length;i+=3)child=subscribers[i],callback=subscribers[i+settled],child?invokeCallback(settled,child,callback,detail):callback(detail);promise._subscribers.length=0}}function ErrorObject(){this.error=null}function tryCatch(callback,detail){try{return callback(detail)}catch(e){return TRY_CATCH_ERROR.error=e,TRY_CATCH_ERROR}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=void 0,failed=void 0;if(hasCallback){if(value=tryCatch(callback,detail),value===TRY_CATCH_ERROR?(failed=!0,error=value.error,value=null):succeeded=!0,promise===value)return void _reject(promise,cannotReturnOwn())}else value=detail,succeeded=!0;promise._state!==PENDING||(hasCallback&&succeeded?_resolve(promise,value):failed?_reject(promise,error):settled===FULFILLED?fulfill(promise,value):settled===REJECTED&&_reject(promise,value))}function initializePromise(promise,resolver){try{resolver(function(value){_resolve(promise,value)},function(reason){_reject(promise,reason)})}catch(e){_reject(promise,e)}}function nextId(){return id++}function makePromise(promise){promise[PROMISE_ID]=id++,promise._state=void 0,promise._result=void 0,promise._subscribers=[]}function Enumerator(Constructor,input){this._instanceConstructor=Constructor,this.promise=new Constructor(noop),this.promise[PROMISE_ID]||makePromise(this.promise),isArray(input)?(this._input=input,this.length=input.length,this._remaining=input.length,this._result=new Array(this.length),0===this.length?fulfill(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&fulfill(this.promise,this._result))):_reject(this.promise,validationError())}function validationError(){return new Error("Array Methods must be provided an Array")}function all(entries){return new Enumerator(this,entries).promise}function race(entries){var Constructor=this;return new Constructor(isArray(entries)?function(resolve,reject){for(var length=entries.length,i=0;length>i;i++)Constructor.resolve(entries[i]).then(resolve,reject)}:function(_,reject){return reject(new TypeError("You must pass an array to race."))})}function reject(reason){var Constructor=this,promise=new Constructor(noop);return _reject(promise,reason),promise}function needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Promise(resolver){this[PROMISE_ID]=nextId(),this._result=this._state=void 0,this._subscribers=[],noop!==resolver&&("function"!=typeof resolver&&needsResolver(),this instanceof Promise?initializePromise(this,resolver):needsNew())}function polyfill(){var local=void 0;if("undefined"!=typeof global)local=global;else if("undefined"!=typeof self)local=self;else try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve())}catch(e){}if("[object Promise]"===promiseToString&&!P.cast)return}local.Promise=Promise}var _isArray=void 0;_isArray=Array.isArray?Array.isArray:function(x){return"[object Array]"===Object.prototype.toString.call(x)};var isArray=_isArray,len=0,vertxNext=void 0,customSchedulerFn=void 0,asap=function(callback,arg){queue[len]=callback,queue[len+1]=arg,len+=2,2===len&&(customSchedulerFn?customSchedulerFn(flush):scheduleFlush())},browserWindow="undefined"!=typeof window?window:void 0,browserGlobal=browserWindow||{},BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver,isNode="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),isWorker="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,queue=new Array(1e3),scheduleFlush=void 0;scheduleFlush=isNode?useNextTick():BrowserMutationObserver?useMutationObserver():isWorker?useMessageChannel():void 0===browserWindow&&"function"==typeof _dereq_?attemptVertx():useSetTimeout();var PROMISE_ID=Math.random().toString(36).substring(16),PENDING=void 0,FULFILLED=1,REJECTED=2,GET_THEN_ERROR=new ErrorObject,TRY_CATCH_ERROR=new ErrorObject,id=0;return Enumerator.prototype._enumerate=function(){for(var length=this.length,_input=this._input,i=0;this._state===PENDING&&length>i;i++)this._eachEntry(_input[i],i)},Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor,resolve$$=c.resolve;if(resolve$$===resolve){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING)this._settledAt(entry._state,i,entry._result);else if("function"!=typeof _then)this._remaining--,this._result[i]=entry;else if(c===Promise){var promise=new c(noop);handleMaybeThenable(promise,entry,_then),this._willSettleAt(promise,i)}else this._willSettleAt(new c(function(resolve$$){return resolve$$(entry)}),i)}else this._willSettleAt(resolve$$(entry),i)},Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;promise._state===PENDING&&(this._remaining--,state===REJECTED?_reject(promise,value):this._result[i]=value),0===this._remaining&&fulfill(promise,this._result)},Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;subscribe(promise,void 0,function(value){return enumerator._settledAt(FULFILLED,i,value)},function(reason){return enumerator._settledAt(REJECTED,i,reason)})},Promise.all=all,Promise.race=race,Promise.resolve=resolve,Promise.reject=reject,Promise._setScheduler=setScheduler,Promise._setAsap=setAsap,Promise._asap=asap,Promise.prototype={constructor:Promise,then:then,"catch":function(onRejection){return this.then(null,onRejection)}},polyfill(),Promise.polyfill=polyfill,Promise.Promise=Promise,Promise})}).call(this,_dereq_("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:8}],7:[function(_dereq_,module){"use strict";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}var has=Object.prototype.hasOwnProperty,prefix="function"!=typeof Object.create?"~":!1;EventEmitter.prototype._events=void 0,EventEmitter.prototype.eventNames=function(){var name,events=this._events,names=[];if(!events)return names;for(name in events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function(event,exists){var evt=prefix?prefix+event:event,available=this._events&&this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);l>i;i++)ee[i]=available[i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if("function"==typeof listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);len>i;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;length>i;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);len>j;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,!0),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return this;var listeners=this._events[evt],events=[];if(fn)if(listeners.fn)(listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context)&&events.push(listeners);else for(var i=0,length=listeners.length;length>i;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);return events.length?this._events[evt]=1===events.length?events[0]:events:delete this._events[evt],this},EventEmitter.prototype.removeAllListeners=function(event){return this._events?(event?delete this._events[prefix?prefix+event:event]:this._events=prefix?{}:Object.create(null),this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,"undefined"!=typeof module&&(module.exports=EventEmitter)},{}],8:[function(_dereq_,module){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],9:[function(_dereq_,module,exports){(function(process){var TWEEN=TWEEN||function(){var _tweens=[];return{getAll:function(){return _tweens},removeAll:function(){_tweens=[]},add:function(tween){_tweens.push(tween)},remove:function(tween){var i=_tweens.indexOf(tween);-1!==i&&_tweens.splice(i,1)},update:function(time,preserve){if(0===_tweens.length)return!1;var i=0;for(time=void 0!==time?time:TWEEN.now();i<_tweens.length;)_tweens[i].update(time)||preserve?i++:_tweens.splice(i,1);return!0}}}();TWEEN.now="undefined"==typeof window&&"undefined"!=typeof process?function(){var time=process.hrtime();return 1e3*time[0]+time[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now.bind(window.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},TWEEN.Tween=function(object){var _repeatDelayTime,_object=object,_valuesStart={},_valuesEnd={},_valuesStartRepeat={},_duration=1e3,_repeat=0,_yoyo=!1,_isPlaying=!1,_reversed=!1,_delayTime=0,_startTime=null,_easingFunction=TWEEN.Easing.Linear.None,_interpolationFunction=TWEEN.Interpolation.Linear,_chainedTweens=[],_onStartCallback=null,_onStartCallbackFired=!1,_onUpdateCallback=null,_onCompleteCallback=null,_onStopCallback=null;this.to=function(properties,duration){return _valuesEnd=properties,void 0!==duration&&(_duration=duration),this},this.start=function(time){TWEEN.add(this),_isPlaying=!0,_onStartCallbackFired=!1,_startTime=void 0!==time?time:TWEEN.now(),_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(0===_valuesEnd[property].length)continue;_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}void 0!==_object[property]&&(_valuesStart[property]=_object[property],_valuesStart[property]instanceof Array==!1&&(_valuesStart[property]*=1),_valuesStartRepeat[property]=_valuesStart[property]||0)}return this},this.stop=function(){return _isPlaying?(TWEEN.remove(this),_isPlaying=!1,null!==_onStopCallback&&_onStopCallback.call(_object,_object),this.stopChainedTweens(),this):this},this.end=function(){return this.update(_startTime+_duration),this},this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;numChainedTweens>i;i++)_chainedTweens[i].stop()},this.delay=function(amount){return _delayTime=amount,this},this.repeat=function(times){return _repeat=times,this},this.repeatDelay=function(amount){
return _repeatDelayTime=amount,this},this.yoyo=function(yoyo){return _yoyo=yoyo,this},this.easing=function(easing){return _easingFunction=easing,this},this.interpolation=function(interpolation){return _interpolationFunction=interpolation,this},this.chain=function(){return _chainedTweens=arguments,this},this.onStart=function(callback){return _onStartCallback=callback,this},this.onUpdate=function(callback){return _onUpdateCallback=callback,this},this.onComplete=function(callback){return _onCompleteCallback=callback,this},this.onStop=function(callback){return _onStopCallback=callback,this},this.update=function(time){var property,elapsed,value;if(_startTime>time)return!0;_onStartCallbackFired===!1&&(null!==_onStartCallback&&_onStartCallback.call(_object,_object),_onStartCallbackFired=!0),elapsed=(time-_startTime)/_duration,elapsed=elapsed>1?1:elapsed,value=_easingFunction(elapsed);for(property in _valuesEnd)if(void 0!==_valuesStart[property]){var start=_valuesStart[property]||0,end=_valuesEnd[property];end instanceof Array?_object[property]=_interpolationFunction(end,value):("string"==typeof end&&(end="+"===end.charAt(0)||"-"===end.charAt(0)?start+parseFloat(end):parseFloat(end)),"number"==typeof end&&(_object[property]=start+(end-start)*value))}if(null!==_onUpdateCallback&&_onUpdateCallback.call(_object,value),1===elapsed){if(_repeat>0){isFinite(_repeat)&&_repeat--;for(property in _valuesStartRepeat){if("string"==typeof _valuesEnd[property]&&(_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property])),_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property],_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}return _yoyo&&(_reversed=!_reversed),_startTime=void 0!==_repeatDelayTime?time+_repeatDelayTime:time+_delayTime,!0}null!==_onCompleteCallback&&_onCompleteCallback.call(_object,_object);for(var i=0,numChainedTweens=_chainedTweens.length;numChainedTweens>i;i++)_chainedTweens[i].start(_startTime+_duration);return!1}return!0}},TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){return 0===k?0:1===k?1:-Math.pow(2,10*(k-1))*Math.sin(5*(k-1.1)*Math.PI)},Out:function(k){return 0===k?0:1===k?1:Math.pow(2,-10*k)*Math.sin(5*(k-.1)*Math.PI)+1},InOut:function(k){return 0===k?0:1===k?1:(k*=2,1>k?-.5*Math.pow(2,10*(k-1))*Math.sin(5*(k-1.1)*Math.PI):.5*Math.pow(2,-10*(k-1))*Math.sin(5*(k-1.1)*Math.PI)+1)}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?.5*k*k*((s+1)*k-s):.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){return 1/2.75>k?7.5625*k*k:2/2.75>k?7.5625*(k-=1.5/2.75)*k+.75:2.5/2.75>k?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return.5>k?.5*TWEEN.Easing.Bounce.In(2*k):.5*TWEEN.Easing.Bounce.Out(2*k-1)+.5}}},TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;return 0>k?fn(v[0],v[1],f):k>1?fn(v[m],v[m-1],m-f):fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){for(var b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein,i=0;n>=i;i++)b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i);return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;return v[0]===v[m]?(0>k&&(i=Math.floor(f=m*(1+k))),fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):0>k?v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):fn(v[i?i-1:0],v[i],v[i+1>m?m:i+1],v[i+2>m?m:i+2],f-i)},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var s=1;if(a[n])return a[n];for(var i=n;i>1;i--)s*=i;return a[n]=s,s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}},function(root){"function"==typeof define&&define.amd?define([],function(){return TWEEN}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=TWEEN:void 0!==root&&(root.TWEEN=TWEEN)}(this)}).call(this,_dereq_("_process"))},{_process:8}],10:[function(){"use strict";THREE.CSS2DObject=function(element,hotspotId){this.hotspotId=hotspotId,this.element=element,this.element.style.position="absolute",this.object=new THREE.Object3D,this.object.name="hotspotName",this.object.hotspotId=hotspotId,this.object.element=element,this.object.element.style.position="absolute"},THREE.CSS2DRenderer=function(){var _width,_height,_widthHalf,_heightHalf,vector=new THREE.Vector3,viewMatrix=new THREE.Matrix4,viewProjectionMatrix=new THREE.Matrix4,cache={objects:new WeakMap},domElement=document.createElement("div");domElement.style.overflow="hidden",this.domElement=domElement,this.getSize=function(){return{width:_width,height:_height}},this.setSize=function(width,height){_width=width,_height=height,_widthHalf=_width/2,_heightHalf=_height/2,domElement.style.width=width+"px",domElement.style.height=height+"px"};var renderCss2DObject=function(hotspotData,camera){if(hotspotData instanceof THREE.CSS2DObject){var object=hotspotData.object;vector.setFromMatrixPosition(object.matrixWorld),vector.applyMatrix4(viewProjectionMatrix);var element=hotspotData.element,style="translate("+Math.round(vector.x*_widthHalf+_widthHalf)+"px,"+Math.round(-vector.y*_heightHalf+_heightHalf)+"px)";if(element.style.WebkitTransform=style,element.style.MozTransform=style,element.style.oTransform=style,element.style.transform=style,element.style.display=object.visible&&vector.z>=-1&&vector.z<=1?"":"none",vector.x>-1&&vector.x<1&&vector.y>-1&&vector.y<1){var lastClassNameArr=element.className.split(" ").filter(function(item){return item&&"center"!==item});lastClassNameArr.push("center"),element.className=lastClassNameArr.join(" "),element.setAttribute("isshow",!0)}else element.className=element.className.replace(" center",""),element.removeAttribute("isshow");var objectData={distanceToCameraSquared:getDistanceToSquared(camera,object)};cache.objects.set(object,objectData),element.parentNode!==domElement&&domElement.appendChild(element)}},getDistanceToSquared=function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(object1,object2){return a.setFromMatrixPosition(object1.matrixWorld),b.setFromMatrixPosition(object2.matrixWorld),a.distanceToSquared(b)}}(),filterAndFlatten=function(scene){var result=[];return scene.traverse(function(object){object instanceof THREE.CSS2DObject&&result.push(object)}),result},zOrder=function(scene){for(var sorted=filterAndFlatten(scene).sort(function(a,b){var distanceA=cache.objects.get(a).distanceToCameraSquared,distanceB=cache.objects.get(b).distanceToCameraSquared;return distanceA-distanceB}),zMax=sorted.length,i=0,l=sorted.length;l>i;i++)sorted[i].element.style.zIndex=zMax-i};this.render=function(scene,camera){var hostpotData=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];scene.updateMatrixWorld(),null===camera.parent&&camera.updateMatrixWorld(),viewMatrix.copy(camera.matrixWorldInverse),viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,viewMatrix),hostpotData.forEach(function(item){renderCss2DObject(item,camera)}),zOrder(scene)}}},{}],11:[function(_dereq_,module){"use strict";function EmbedSpotManager(scene,selector,worldRender){EventEmitter.call(this),this.selector=selector,this.rwe=function(){return worldRender},this.embedspotRoot=new THREE.Group,this.videoArray={},this.embedspotRoot.name="embedspotRoot",scene.add(this.embedspotRoot),this.width=4096,this.height=2048,this.size=new THREE.Vector2(1,1),this.raycaster=new THREE.Raycaster,this.pointer=new THREE.Vector2(1,1),this.videoPlayTexture=null,this.init()}var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(_dereq_("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/asyncToGenerator")),EventEmitter=_dereq_("eventemitter3"),Util=(_dereq_("tween.js"),_dereq_("./util"));EmbedSpotManager.prototype=new EventEmitter,EmbedSpotManager.prototype.constructor=EmbedSpotManager,EmbedSpotManager.prototype.init=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee(){return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.loadImgRes("https://img11.360buyimg.com/imagetools/jfs/t1/39956/14/15308/3601/5f463f40E9d3a70dd/34ac60c9b12f2c6c.png");case 2:this.videoPlayTexture=_context.sent;case 3:case"end":return _context.stop()}},_callee,this)})),EmbedSpotManager.prototype.add=function(){var _ref2=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee2(param){var embedObj;return _regenerator["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:embedObj=null,_context2.t0=param.type,_context2.next="img"===_context2.t0?4:"video"===_context2.t0?8:12;break;case 4:return _context2.next=6,this.creatEmbedImg(param);case 6:return embedObj=_context2.sent,_context2.abrupt("break",14);case 8:return _context2.next=10,this.creatEmbedVideo(param);case 10:return embedObj=_context2.sent,_context2.abrupt("break",14);case 12:return console.log(" error embed"),_context2.abrupt("break",14);case 14:embedObj&&(embedObj.position.set(param.position.x,param.position.y,param.position.z),embedObj.rotation.set(param.rotation.x,param.rotation.y,param.rotation.z,param.rotation.order),this.embedspotRoot.add(embedObj));case 15:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref2.apply(this,arguments)}}(),EmbedSpotManager.prototype.loadImgRes=function(){var _ref3=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee3(url){return _regenerator["default"].wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",new Promise(function(resolve,reject){(new THREE.TextureLoader).load(url,function(texture){resolve(texture)},void 0,function(err){reject(err)})}));case 1:case"end":return _context3.stop()}},_callee3)}));return function(){return _ref3.apply(this,arguments)}}(),EmbedSpotManager.prototype.creatEmbedVideo=function(){var _ref4=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee4(param){var video,videoTexture,texture,planeGeometry,material,video_button,videospot;return _regenerator["default"].wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return video=document.createElement("video"),video.id=param.id,video.src=param.url,video.poster=param.cover,video.crossOrigin="anonymous",video.setAttribute("webkit-playsinline","webkit-playsinline"),video.setAttribute("playsinline","playsinline"),video.loop=!0,videoTexture=new THREE.VideoTexture(video),videoTexture.wrapS=videoTexture.wrapT=THREE.ClampToEdgeWrapping,videoTexture.minFilter=THREE.LinearFilter,videoTexture.magFilter=THREE.LinearFilter,videoTexture.format=THREE.RGBFormat,videoTexture.generateMipmaps=!1,videoTexture.needsUpdate=!0,_context4.next=17,this.loadImgRes(param.cover);case 17:return texture=_context4.sent,planeGeometry=new THREE.PlaneBufferGeometry(param.size.width,param.size.height),material=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,map:texture,opacity:1,depthTest:!1,side:THREE.DoubleSide}),video_button=this.creatVideoPlayButton(),videospot=new THREE.Mesh(planeGeometry,material),videospot.scale.x=param.scale.x,videospot.scale.y=param.scale.y,videospot.scale.z=param.scale.z,videospot.renderOrder=1,videospot.rotation.set(param.rotation.x,param.rotation.y,param.rotation.z),videospot.name="embed_video",videospot.userData=param,this.videoArray[param.id]={dom:video,texture:videoTexture,Material:material,button:video_button,isPlay:!1,url:param.url,id:param.id,poster:param.cover},videospot.add(video_button),_context4.abrupt("return",videospot);case 32:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref4.apply(this,arguments)}}(),EmbedSpotManager.prototype.testEmbedEmbetSpot=function(e){this.size=this.getSize_();var clientX=e.clientX||e.changedTouches[0].clientX,clientY=e.clientY||e.changedTouches[0].clientY;this.pointer.x=clientX/this.size.width*2-1,this.pointer.y=2*-(clientY/this.size.height)+1,this.raycaster.setFromCamera(this.pointer,this.rwe().camera);var embedspots=this.embedspotRoot.children,intersects=this.raycaster.intersectObjects(embedspots);if(intersects.length){var spot=intersects[0].object;if("video"==spot.userData.type){var videoConfig=this.videoArray[spot.userData.id];if(Util.isIOS10OrLess()){var param={type:"embed-video",url:videoConfig.url,id:videoConfig.id,poster:videoConfig.poster};this.emit("embed-click",param)}else{var _videoConfig=this.videoArray[spot.userData.id];_videoConfig.isPlay?(_videoConfig.button.visible=!0,_videoConfig.dom.pause(),_videoConfig.isPlay=!1):(this.allVideoPause(),_videoConfig.Material.map=_videoConfig.texture,_videoConfig.button.visible=!1,_videoConfig.dom.play(),_videoConfig.isPlay=!0)}}else this.emit("embed-click",spot.userData);return!0}return this.emit("scene-click",e),!1},EmbedSpotManager.prototype.allVideoPause=function(){for(var key in this.videoArray){var videoConfig=this.videoArray[key];videoConfig.button.visible=!0,videoConfig.dom.pause(),videoConfig.isPlay=!1}},EmbedSpotManager.prototype.onClick_=function(e){this.testEmbedEmbetSpot(e)},EmbedSpotManager.prototype.getSize_=function(){return this.rwe().renderer.getSize(this.size)},EmbedSpotManager.prototype.updateMouse_=function(e){this.size=this.getSize_(),this.pointer.x=e.clientX/this.size.width*2-1,this.pointer.y=2*-(e.clientY/this.size.height)+1},EmbedSpotManager.prototype.creatVideoPlayButton=function(){if(this.videoPlayTexture){var planeGeometry=new THREE.PlaneBufferGeometry(26,26),material=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,map:this.videoPlayTexture,opacity:1,depthTest:!1,side:THREE.DoubleSide}),videospot=new THREE.Mesh(planeGeometry,material);return videospot.renderOrder=2,videospot}return console.log("cant fin videoPlayTexture"),null},EmbedSpotManager.prototype.creatEmbedImg=function(){var _ref5=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee5(param){var texture,Geometry,Material,imgInfo;return _regenerator["default"].wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this.loadImgRes(param.url);case 2:return texture=_context5.sent,Geometry=new THREE.PlaneBufferGeometry(param.size.width,param.size.height),Material=new THREE.MeshBasicMaterial({color:16777215,map:texture,side:THREE.DoubleSide,transparent:!0,depthTest:!1}),imgInfo=new THREE.Mesh(Geometry,Material),imgInfo.scale.x=param.scale.x,imgInfo.scale.y=param.scale.y,imgInfo.scale.z=param.scale.z,imgInfo.rotation.set(param.rotation.x,param.rotation.y,param.rotation.z,param.rotation.order),imgInfo.name="embed_img",imgInfo.userData=param,imgInfo.renderOrder=1,_context5.abrupt("return",imgInfo);case 14:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),EmbedSpotManager.prototype.addAllEmbed=function(param){if(param.embedSpots&&param){param.width?(this.width=param.width,this.height=param.height):(this.width=4096,this.height=2048);var self=this;param.embedSpots.forEach(function(element){self.add(element)})}},EmbedSpotManager.prototype.clearAll=function(){for(var allChildren=this.embedspotRoot.children,i=allChildren.length-1;i>=0;i--)this.embedspotRoot.remove(allChildren[i]);for(var key in this.videoArray)delete this.videoArray[key]},EmbedSpotManager.prototype.update=function(){},module.exports=EmbedSpotManager},{"./util":27,"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5,eventemitter3:7,"tween.js":9}],12:[function(_dereq_,module){"use strict";var Eyes={LEFT:1,RIGHT:2};module.exports=Eyes},{}],13:[function(_dereq_,module){"use strict";function HotspotManager(scene){EventEmitter.call(this),this.hotspots=null,this.hotspotRoot=new THREE.Group,this.hostpotDatas=[],this.hotspotRoot.name="hotspotRoot",scene.add(this.hotspotRoot),this.width=4096,this.height=2048}var EventEmitter=_dereq_("eventemitter3"),Util=(_dereq_("tween.js"),_dereq_("./util")),SPRITE_DEPTH=450;HotspotManager.prototype=new EventEmitter,HotspotManager.prototype.constructor=HotspotManager,HotspotManager.prototype.add=function(param){if(null!=param&&void 0!=param){var self=this;if("spriteText"==param.type){var style=this.getHotspotStyle(param);if("error"==style.parent)return;var labelDiv=this.createHotspot(style.parent,style.inner);if(param.parameter.ar&&labelDiv.classList.add("ar"),Util.isMobile()){var hasmove=!1;labelDiv.addEventListener("touchmove",function(){hasmove=!0}),labelDiv.addEventListener("touchend",function(e){!hasmove&&self.emit("click",param,e),hasmove=!1})}else labelDiv.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),self.emit("click",param,e)});var labelObj=null;try{labelObj=new THREE.CSS2DObject(labelDiv,param.id)}catch(err){console.log(err)}labelObj.name="hotspotName";var position=this.getHotspotPos(param);if(labelObj.object.position.copy(position),param.pitch)return void this.hotspotRoot.add(labelObj.object);param.position.pitch||(this.hotspotRoot.rotation.y=0),this.hostpotDatas.push(labelObj),this.hotspotRoot.add(labelObj.object)}}},HotspotManager.prototype.getHotspotPos=function(param){if(param.pitch){var param_position={pitch:param.pitch,yaw:param.yaw,distance:1},position=this.sph2vec(param_position);return position}if(param.position&&param.position.pitch){var _position=this.sph2vec(param.position);return Util.isDebug()&&console.log("position : ",_position),_position}return new THREE.Vector3(param.position.x,param.position.y,param.position.z)},HotspotManager.prototype.addAllHost=function(param){if(param.hotSpots&&param){this.hotspots=param.hotSpots,param.width?(this.width=param.width,this.height=param.height):(this.width=4096,this.height=2048);var self=this;param.hotSpots.forEach(function(element){self.add(element)})}},HotspotManager.prototype.handleHotSpotClick=function(item){this.emit("click",item)},HotspotManager.prototype.getCount=function(){if(this.hotspots)return 0;var count=0;for(var id in this.hotspots)count+=1;return count},HotspotManager.prototype.creatCouponHotPoint=function(){!Util.isMobile()},HotspotManager.prototype.creatSceneHotPoint=function(){},HotspotManager.prototype.getHotspotStyle=function(param){var self=this,style={parent:null,inner:null};if(!param.action_type)return style=self.creatCommodityStyle(param);switch(param.action_type){case"getCoupon":Util.isMobile()?(style.parent="hotspot-coupon",style.inner='<div class="coupon-bg"></div><div class="name-wrap"><span class="name">'+param.parameter.title+'</span><i class="arrow-icon"></i></div>'):style.parent="error";break;case"gotoScene":style.parent="pano-scene",style.inner=param.parameter.iconUrl?'<div class="scene-icon build-in"><img src="'+param.parameter.iconUrl+'" /></div><div class="scene-name">'+param.parameter.title+"</div>":'<div class="scene-icon"></div><div class="scene-name">'+param.parameter.title+"</div>";break;case"showImage":style.parent="hotspot-icon img",style.inner='<div class="inner"><div class="icon"></div><div class="name-wrap"><span class="name">'+param.parameter.title+'</span><i class="arrow-icon"></i></div></div>';break;case"showImageText":style.parent="hotspot-icon imgtxt",style.inner='<div class="inner"><div class="icon"></div><div class="name-wrap"><span class="name">'+param.parameter.title+'</span><i class="arrow-icon"></i></div></div>';break;case"showVideo":style.parent="hotspot-icon video",style.inner='<div class="inner"><div class="icon"></div><div class="name-wrap"><span class="name">'+param.parameter.title+'</span><i class="arrow-icon"></i></div></div>';break;case"getLink":style.parent="hotspot-icon link",style.inner='<div class="inner"><div class="icon"></div><div class="name-wrap"><span class="name">'+param.parameter.title+'</span><i class="arrow-icon"></i></div></div>';break;case"anchor_typea":style=self.createAnchorAElement(param);break;case"anchor_typeb":style=self.createAnchorBElement(param);break;default:style=self.creatCommodityStyle(param)}return style},HotspotManager.prototype.createAnchorAElement=function(param){var label=(param.name,param.title,param.label),style={parent:null,inner:null};return style.parent="pano-commodity",style.inner='<div class="anchor_typea">'.concat(label,"</div>"),style},HotspotManager.prototype.createAnchorBElement=function(param){function formatPrice(price){var arr=price.toString().split("."),decimal=arr[1];return"00"===arr[1]?decimal="":/[1-9]0/.test(arr[1])&&(decimal=arr[1][0]),[arr[0],decimal]}var label=param.label,price=param.price,dealPrice=param.dealPrice,sellpoint1=(param.sellpoint,param.sellpoint1),style={parent:null,inner:null},priceArr=formatPrice(price);price=priceArr[0]+(priceArr[1]?"."+priceArr[1]:""),style.parent="product_anchor";var dealPriceHtml="";if(dealPrice>0){dealPriceHtml="";var dsPriceArr=formatPrice(dealPrice);price=dsPriceArr[0]+(dsPriceArr[1]?"."+dsPriceArr[1]:"")}return style.inner='\n      <div class="product_anchor_circle" id="p-'.concat(param.id,'" data-sku="').concat(param.parameter.sku,'" ></div>\n      <div class="product_anchor_text">\n        <div class="content">\n          ').concat(label,'\n        </div>\n      </div>\n      <div class="product_anchor_info">\n        <div class="content">\n                  <div class="anchor_describe_left">\n                      <div class="gouwu_icon white"></div>\n                      <div class="gouwu_icon red"></div>\n                  </div>\n                  <div class="anchor_describe_right">\n                      <div class="top">\n                        <span class="name">').concat(label,'</span>\n                      </div>\n                      <div class="price-info ').concat(dealPrice>0?"":"no-dsprice",'"  >\n                        <span class="price-type">').concat(dealPriceHtml,'</span>\n                        <span class="price">').concat(price,'</span>\n                      </div>\n                      <div class="bottom">\n                          <span class="describe">').concat(sellpoint1,'</span>\n                      </div>\n                      <div class="icon_style">\n                          <div class="godetail"></div>\n                      </div>\n                  </div>\n              </div>\n      </div>'),style},HotspotManager.prototype.creatCommodityStyle=function(param){var style={parent:null,inner:null};style.parent="pano-commodity";var buy='<div class="pano-buy">';switch(param.parameter.color){case 1:buy='<div class="pano-btn one">';break;case 2:buy='<div class="pano-btn two">';break;case 3:buy='<div class="pano-btn three">';break;case 4:buy='<div class="pano-btn four">';break;case 5:buy='<div class="pano-btn five">';break;default:buy='<div class="pano-btn one">'}param.parameter.color||(buy='<div class="pano-btn one">');var normal='<div class="pano-line"><div class="pano-title"><div class="circle-content"><div class="circle-bg"></div><div class="circle"></div></div><div class="title-label">'+param.parameter.title+'</div></div><div class="line"></div></div>',last="";if("-1.00"!=param.parameter.price&&param.parameter.price){var price=param.parameter.price.substring(0,param.parameter.price.indexOf(".")),little_price=param.parameter.price.substring(param.parameter.price.indexOf(".")+1,param.parameter.price.length);last='<div class="pano-price"><div class="price-little"></div><div class="price-big">'+price+'.</div><div class="price-little">'+little_price+'</div></div><div class="pano-buy"><div class="buy-label"></div><div class="buy-icon"></div></div></div>'}else last='<div class="pano-price"><div class="price-little"></div><div class="price-big"></div></div><div class="pano-buy"><div class="buy-label"></div><div class="buy-icon"></div></div></div>';return style.inner=normal+buy+last,style},HotspotManager.prototype.createHotspot=function(parentClass,innerHTML){var labelDiv=document.createElement("div");return labelDiv.className=parentClass,labelDiv.style.display="none",innerHTML&&(labelDiv.innerHTML=innerHTML),labelDiv},HotspotManager.prototype.remove=function(){},HotspotManager.prototype.clearAll=function(){var _this=this;this.hostpotDatas.forEach(function(item){item.element.remove()}),this.hotspotRoot.children.slice(0).forEach(function(v){_this.hotspotRoot.remove(v)}),this.hostpotDatas=[]},HotspotManager.prototype.vec2sph=function(vec){var x=vec.x,y=vec.y,z=vec.z,pitch=(vec.length,THREE.Math.radToDeg(vec.angleTo(new THREE.Vector3(x,0,z))));0>y&&(pitch=-pitch);var yaw=THREE.Math.radToDeg(new THREE.Vector3(x,0,z).angleTo(new THREE.Vector3(0,0,-1)));return x>0&&(yaw=-yaw),{pitch:pitch,yaw:yaw,distance:1}},HotspotManager.prototype.sph2vec=function(shp){var deg=this.coorToDeg(shp.pitch,shp.yaw),pitch=parseFloat(deg.ydeg),yaw=parseFloat(deg.xdeg),distance=SPRITE_DEPTH*shp.distance,pitchRad=THREE.Math.degToRad(90-pitch),yawRad=THREE.Math.degToRad(yaw),z=-distance*Math.sin(pitchRad)*Math.cos(yawRad),x=-distance*Math.sin(pitchRad)*Math.sin(yawRad),y=distance*Math.cos(pitchRad);return new THREE.Vector3(x,y,z)},HotspotManager.prototype.coorToDeg=function(pitch,yaw){var deg={xdeg:0,ydeg:0},halfWidth=this.width/2,halfHeight=this.height/2;return deg.xdeg=(halfWidth-yaw)/halfWidth*180,deg.ydeg=(halfHeight-pitch)/halfHeight*90,deg},HotspotManager.prototype.sph2img=function(sph){var pitch=sph.pitch,yaw=sph.yaw,pr=180,ih=this.sceneHeight,iw=this.sceneWidth,dp=ih/pr,dy=iw/360,ipitch=(90-pitch)*dp,iyaw=(180-yaw)*dy;return{pitch:ipitch,yaw:iyaw,distance:1}},HotspotManager.prototype.img2sph=function(img){var pitch=img.pitch,yaw=img.yaw,pr=180,ih=this.sceneHeight,iw=this.sceneWidth,dp=ih/pr,dy=iw/360,spitch=90-pitch/dp,syaw=180-yaw/dy;return{pitch:spitch,yaw:syaw,distance:1}},module.exports=HotspotManager},{"./util":27,eventemitter3:7,"tween.js":9}],14:[function(_dereq_,module){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var KalmanFilter=function(){function KalmanFilter(){var _ref=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_ref$R=_ref.R,R=void 0===_ref$R?1:_ref$R,_ref$Q=_ref.Q,Q=void 0===_ref$Q?1:_ref$Q,_ref$A=_ref.A,A=void 0===_ref$A?1:_ref$A,_ref$B=_ref.B,B=void 0===_ref$B?0:_ref$B,_ref$C=_ref.C,C=void 0===_ref$C?1:_ref$C;_classCallCheck(this,KalmanFilter),this.R=R,this.Q=Q,this.A=A,this.C=C,this.B=B,this.cov=0/0,this.x=0/0}return _createClass(KalmanFilter,[{key:"filter",value:function(z){var u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(isNaN(this.x))this.x=1/this.C*z,this.cov=1/this.C*this.Q*(1/this.C);else{var predX=this.predict(u),predCov=this.uncertainty(),K=predCov*this.C*(1/(this.C*predCov*this.C+this.Q));this.x=predX+K*(z-this.C*predX),this.cov=predCov-K*this.C*predCov}return this.x}},{key:"predict",value:function(){var u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.A*this.x+this.B*u}},{key:"uncertainty",value:function(){return this.A*this.cov*this.A+this.R}},{key:"lastMeasurement",value:function(){return this.x}},{key:"setMeasurementNoise",value:function(noise){this.Q=noise}},{key:"setProcessNoise",value:function(noise){this.R=noise}}]),KalmanFilter}();module.exports=KalmanFilter},{}],15:[function(_dereq_,module){"use strict";function LoadingIndicator(selector){this.selector=selector,this.el=this.build_();var load=document.getElementById(selector);load?load.appendChild(this.el):document.body.append(this.el),this.show()}LoadingIndicator.prototype.build_=function(){var overlay=document.createElement("div"),s=overlay.style;s.position="absolute",s.top=0,s.left=0,s.width="100%",s.height="100%",s.background="#eee",overlay.id=this.selector+"-loading",s.zIndex=9999;var img=document.createElement("img");img.src="//img11.360buyimg.com/imagetools/jfs/t1/143106/1/335/146097/5ee07d92E52baadc5/ce71c4c0e36571ca.gif";var s=img.style;return s.position="absolute",s.width=Util.isMobile()?"30%":"15%",s.top="50%",s.left="50%",s.transform="translate(-50%, -50%)",overlay.appendChild(img),overlay},LoadingIndicator.prototype.hide=function(){this.el.style.display="none"},LoadingIndicator.prototype.show=function(){this.el.style.display="block"},module.exports=LoadingIndicator},{}],16:[function(_dereq_,module){"use strict";var Player=_dereq_("./player"),VRView={Player:Player};module.exports=VRView},{"./player":23}],17:[function(_dereq_,module){"use strict";function Opanorama(config,vm){this._config=Object.assign({camera:null,container:document.body,radius:500,fov:100,offsetLongitude:0,offsetLatitude:0,supportTouch:!0,supportOrient:!0},config),this.rvm=function(){return vm},this.camera=config.camera,config=this._config,this._fix={lat:config.offsetLatitude||0,lon:config.offsetLongitude||0,isFixed:config.offsetLatitude||config.offsetLongitude};var detLon=270-this._fix.lon;this._fix.lon=detLon>0?detLon:360-this._fix.lon+270,this.auto_rotation={lat:0,lon:0},this._touch={lat:0,lon:0},this._orient={lat:0,lon:0},this.last_orient={lat:0,lon:0},this.current_orient={lat:0,lon:0},this.isOpenAutoRation=!1,this.isAutoRotation=!1,this.autoEvent=null,this.autoDelayTime=10,this.currentTime=0,this.cruiseTime=120,this.cruiseRate=60,this.cruiseSpeed=360/this.cruiseTime/this.cruiseRate,this.horizontalLock=config.horizontalLock,this.verticalLock=config.verticalLock,this.init(),this.update(),this._initTouchControl(),this._initOrientControl()}var EventEmitter=_dereq_("eventemitter3"),Toucher=_dereq_("./touch"),Orienter=_dereq_("./orienter"),TWEEN=_dereq_("tween.js");Opanorama.prototype=new EventEmitter,Opanorama.prototype.resize=function(){this.camera.lookAt(this.camera.target)},Opanorama.prototype._initTouchControl=function(){var self=this,config=this._config;if(config.supportTouch){this._toucher=new Toucher({container:config.container,radius:config.radius,selector:config.selector,horizontalLock:config.horizontalLock,verticalLock:config.verticalLock,onChange:function(touch){if(touch.deltaFov){
var fov=self.camera.fov+touch.deltaFov;fov=THREE.MathUtils.clamp(fov,50,110),self.camera.fov=fov,self.camera.updateProjectionMatrix()}void 0!==touch.lon&&void 0!==touch.lat&&(self._fix.lat+self._orient.lat+touch.lat>90?self._fix.lat=90-self._orient.lat-touch.lat:self._fix.lat+self._orient.lat+touch.lat<-90&&(self._fix.lat=-90-self._orient.lat-touch.lat),self._touch={lon:touch.lon,lat:touch.lat})},onStart:function(){self.autoRotationController(!1),self.emit("touchStart")},onEnd:function(e){self.autoRotationController(!0),self.emit("touchEnd",e)},onMove:function(e){self.emit("touchMove",e)}},this.rvm())}},Opanorama.prototype.destroy=function(){this._toucher&&this._toucher.unbind(),this._orienter&&this._orienter.destroy()},Opanorama.prototype._initOrientControl=function(){var self=this,config=this._config;config.supportOrient&&(this._orienter=new Orienter({onChange:function(orient){self._orient={lat:orient.lat,lon:orient.lon},self.current_orient={lat:orient.lat,lon:orient.lon},self._orient=self.isGyroscope?{lat:orient.lat,lon:orient.lon}:self.last_orient}}))},Opanorama.prototype.setWordDeviceorientation=function(status){this.isGyroscope=status,Util.isDebug()&&console.log("setWordDeviceorientation_____",this.isGyroscope,"this._orienter",this._orienter),status&&null==this._orienter&&(Util.isDebug()&&console.log("this._config.supportOrient = true;"),this._config.supportOrient=!0,this._initOrientControl()),null!=this._orienter&&(console.log("_setsetWordDeviceorientation"),this._orienter._setsetWordDeviceorientation(status));var lat=this.current_orient.lat,lon=this.current_orient.lon;this.last_orient={lat:lat,lon:lon}},Opanorama.prototype.updateCompass=function(){var camera=this.camera,lookAt=camera.target,sp=new THREE.Spherical;sp.setFromVector3(lookAt),sp=Math.round(THREE.Math.radToDeg(sp.theta)),this.emit("compassUpdate",-sp+180)},Opanorama.prototype.update=function(){var lat=this._touch.lat+this._fix.lat+this._orient.lat+this.auto_rotation.lat,lon=this._touch.lon+this._fix.lon+this._orient.lon+this.auto_rotation.lon;this.isAutoRotation&&null!=this.camera&&!this.isGyroscope&&this.isOpenAutoRation&&(this.auto_rotation.lon+=this.cruiseSpeed),lat=Math.max(-89,Math.min(89,lat)),lat=THREE.Math.degToRad(lat),lon=THREE.Math.degToRad(lon),this.camera.target.x=500*Math.cos(lat)*Math.cos(lon),this.camera.target.y=500*Math.sin(lat),this.camera.target.z=500*Math.cos(lat)*Math.sin(lon),this.resize(),this.updateCompass()},Opanorama.prototype.lookAtHotspot=function(){var _this=this;if(!this.isGyroscope){this._toucher.enable=!1,this.autoRotationController(!1);var pos=new THREE.Vector3(0,0,0),sp=new THREE.Spherical;sp.setFromVector3(pos);var destTheta=sp.theta,destPhi=sp.phi;sp.setFromVector3(this.camera.target);var dt=destTheta-sp.theta,dp=destPhi-sp.phi;dt=THREE.Math.radToDeg(dt),dp=THREE.Math.radToDeg(dp);var from={lon:this._toucher.lon,lat:this._toucher.lat};this._toucher.lon-=dt,this._toucher.lat-=dp;var to={lon:this._toucher.lon,lat:this._toucher.lat};Math.abs(to.lon-from.lon)>180&&(from.lon=to.lon>from.lon?from.lon+360:from.lon-360);var tw=new TWEEN.Tween(from);return new Promise(function(res){tw.to(to,300).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){_this._toucher.lon=from.lon,_this._toucher.lat=from.lat,_this._touch.lon=_this._toucher.lon,_this._touch.lat=_this._toucher.lat}).onComplete(function(){_this._toucher.enable=!0,res()}).start()})}},Opanorama.prototype.lookAtPosition=function(position){var _this2=this;if(!this.isGyroscope){this._toucher.enable=!1,this.autoRotationController(!1);var sp=new THREE.Spherical;sp.setFromVector3(position);var destTheta=sp.theta,destPhi=sp.phi;sp.setFromVector3(this.camera.target);var dt=destTheta-sp.theta,dp=destPhi-sp.phi;dt=THREE.Math.radToDeg(dt),dp=THREE.Math.radToDeg(dp);var from={lon:this._toucher.lon,lat:this._toucher.lat};this._toucher.lon-=dt,this._toucher.lat-=dp;var to={lon:this._toucher.lon,lat:this._toucher.lat};Math.abs(to.lon-from.lon)>180&&(from.lon=to.lon>from.lon?from.lon+360:from.lon-360);var tw=new TWEEN.Tween(from);return new Promise(function(res){tw.to(to,300).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){_this2._toucher.lon=from.lon,_this2._toucher.lat=from.lat,_this2._touch.lon=_this2._toucher.lon,_this2._touch.lat=_this2._toucher.lat}).onComplete(function(){_this2._toucher.enable=!0,res()}).start()})}},Opanorama.prototype.startCountDown=function(){var _this3=this,startTimestamp=+new Date,startTime=this.autoDelayTime,countDown=function countDown(){_this3.currentTime=startTime-(+new Date-startTimestamp)/1e3,_this3.currentTime<=0?(_this3.currentTime=0,_this3.isAutoRotation=!0,_this3.emit("cruiseStart")):_this3.autoEvent=requestAnimationFrame(countDown)};countDown()},Opanorama.prototype.clearTimeCutDown=function(){this.autoEvent&&(cancelAnimationFrame(this.autoEvent),this.autoEvent=null,this.isAutoRotation=!1,this.emit("cruiseStop"))},Opanorama.prototype.autoRotationController=function(status){this.isOpenAutoRation&&(status?this.autoEvent?(this.clearTimeCutDown(),this.startCountDown()):this.startCountDown():this.clearTimeCutDown())},Opanorama.prototype.setAutoRotationTime=function(time,status,cruiseTime){status||this.autoRotationController(!1),this.isOpenAutoRation=status,time&&(this.autoDelayTime=time/1e3),cruiseTime&&(this.cruiseTime=cruiseTime,this.cruiseSpeed=360/this.cruiseTime/this.cruiseRate),this.isOpenAutoRation&&this.autoRotationController(!0)},Opanorama.prototype.init=function(){var self=this;this.camera.target=new THREE.Vector3(500,0,0),this.isGyroscope=!1,Util.isApp("jd")?(Util.isIOS()&&(window.webviewVisible=function(state){return Util.isDebug()&&console.log("window.webviewVisible state:",state),"0"==state?void self.visibilitychange(!1):void self.visibilitychange(!0)},window.webviewActive=function(state){return Util.isDebug()&&console.log("window.webviewActive state:",state),"0"==state?void self.setAutoRotationTime(null,!1):void self.setAutoRotationTime(null,!0)}),Util.isAndroid()&&(window.webviewVisible=function(state){return Util.isDebug()&&console.log("window.jdar isAndroid",state),"0"==state?(self._orienter.destroy(),void self.visibilitychange(!1)):(self._orienter.bind(),void self.visibilitychange(!0))})):document.addEventListener("visibilitychange",function(){return document.hidden?void self.visibilitychange(!1):void self.visibilitychange(!0)},!1)},Opanorama.prototype.setFixed=function(){},Opanorama.prototype.reset=function(offsetLatitude,offsetLongitude){this.autoRotationController(!1),this.auto_rotation={lon:0,lat:0};var detLon=270-offsetLongitude;this._fix.lon=detLon>0?detLon:360-offsetLongitude+270,this._toucher.reset(),this._orienter.reset(),this._touch={lat:0,lon:0},this._orient={lat:0,lon:0},this.last_orient={lat:0,lon:0},this.current_orient={lat:0,lon:0}},Opanorama.prototype.visibilitychange=function(status){var self=this;status?(window.stopRender=1,this.rvm().rendering=!0,self.setAutoRotationTime(null,!0),self._orienter.setVisibleDeviceorientation(!0)):(window.stopRender=0,this.rvm().rendering=!1,self.setAutoRotationTime(null,!1),self._orienter.setVisibleDeviceorientation(!1))},module.exports=Opanorama},{"./orienter":18,"./touch":26,eventemitter3:7,"tween.js":9}],18:[function(_dereq_,module){"use strict";function Orienter(config){this._config=Object.assign({onChange:function(){},onOrient:function(){}},config),this.lon=this.lat=0,this.moothFactor=10,this.direction=window.orientation||0,this.bind(),this.sinkf=new KalmanFilter,this.latkf=new KalmanFilter,this.VisibleStatus=!1,this.lastLonsin=this.lonsin=this.lastlon=0,this.last_event=this.event={alpha:0,beta:0,gamma:0},this.deltaLon=0,this.last_data={lon:0,lat:0}}var EventEmitter=_dereq_("eventemitter3"),KalmanFilter=_dereq_("./kalman");Orienter.prototype=new EventEmitter,Orienter.prototype.bind=function(){window.addEventListener("deviceorientation",this._bindChange=this._onChange.bind(this)),window.addEventListener("orientationchange",this._bindOrient=this._onOrient.bind(this))},Orienter.prototype.destroy=function(){window.removeEventListener("deviceorientation",this._bindChange,!1),window.removeEventListener("orientationchange",this._bindOrient,!1)},Orienter.prototype._onOrient=function(event){this.direction=window.orientation,this._config.onOrient(event),this.lastLon=this.lastLat=void 0,this.lastLonsin=void 0},Orienter.prototype._mooth=function(x,lx){return void 0===lx?x:(Math.abs(x-lx)>this.boundary&&(lx=lx>this.boundary?0:360),x=lx+(x-lx)/this.moothFactor)},Orienter.prototype._onChange=function(evt){switch(this.event=evt,this.direction){case 0:this.lon=-(evt.alpha+evt.gamma),this.lat=evt.beta-90;break;case 90:this.lon=evt.alpha-Math.abs(evt.beta),this.lat=evt.gamma<0?-90-evt.gamma:90-evt.gamma;break;case-90:this.lon=-(evt.alpha+Math.abs(evt.beta)),this.lat=evt.gamma>0?evt.gamma-90:90+evt.gamma}if(this.lon=this.lon>0?this.lon%360:this.lon%360+360,this.VisibleStatus){console.log("VisibleStatus :",this.VisibleStatus),Util.isDebug()&&console.log("this setVisibleDeviceorientation aaa: ",this.VisibleStatus,"this lon :",this.lon),this.VisibleStatus=!1;var lerpLon=this.lon-this.last_data.lon;0>lerpLon&&(lerpLon+=360),this.last_data={lon:lerpLon,lat:this.lat},console.log("this.last_data :",this.last_data)}this.deltaLon=this.lon-this.last_data.lon,this.deltaLon<0&&(this.deltaLon+=360);var lonsin=Math.sin(this.deltaLon*Math.PI/180);this.lastLonsin=this.lonsin=this.sinkf.filter(lonsin);var lon=180*Math.asin(this.lonsin)/Math.PI;270<this.deltaLon&&this.deltaLon<360?lon+=360:0<this.deltaLon&&this.deltaLon<90||(90<this.deltaLon&&this.deltaLon<180?lon=180-lon:180<this.deltaLon&&this.deltaLon<270&&(lon=180-lon)),this.lastlon=lon,this.lat=this.latkf.filter(this.lat),this.lastLat=this.lat=this._mooth(this.lat,this.lastLat),this._config.onChange({lon:this.lastlon,lat:this.lat})},Orienter.prototype._setsetWordDeviceorientation=function(){this.last_data={lon:this.lastlon,lat:this.lat},console.log("this.last_data : ",this.last_data)},Orienter.prototype.setVisibleDeviceorientation=function(status){this.VisibleStatus=status,status||(this.last_data={lon:this.lastlon,lat:this.lat}),Util.isDebug()&&console.log("this setVisibleDeviceorientation : ",this.VisibleStatus,"this lase data:",this.last_data)},Orienter.prototype.reset=function(){this.lon=this.lat=0,this.moothFactor=10,this.direction=window.orientation||0,this.sinkf=new KalmanFilter,this.latkf=new KalmanFilter,this.VisibleStatus=!1,this.lastLonsin=this.lonsin=this.lastlon=0,this.last_event=this.event={alpha:0,beta:0,gamma:0},this.deltaLon=0,this.last_data={lon:0,lat:0}},module.exports=Orienter},{"./kalman":14,eventemitter3:7}],19:[function(_dereq_,module){"use strict";function PanoCube(_ref){var _this=this,scene=_ref.scene,camera=_ref.camera,isInit=_ref.isInit,openPreview=_ref.openPreview,image=_ref.image,preview_img=_ref.preview_img,resolve=_ref.resolve,reject=_ref.reject;this.isInit=isInit,console.log("cube is init",this.isInit),this.scene=scene,this.camera=camera,this.image=image,this.preview_img=preview_img,this.preview_res,this.img_res,this.resolve=resolve,this.reject=reject,this.openPreview=openPreview,this.isReady=!1,this.photoGroup=this.scene.getObjectByName("photo"),openPreview?this.preview_img?this.loadResource(this.preview_img,function(res){_this.preview_res=res,_this.creatPano(res)},function(){}):(this.preview_res=PanoCube.previewResource,console.log("this.preview_res"),this.creatPano(PanoCube.previewResource)):this.loadResource(this.image,function(res){_this.img_res=res,_this.isReady=!0},function(){})}var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(_dereq_("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/asyncToGenerator")),TWEEN=(_dereq_("./eyes"),_dereq_("tween.js")),_require=(_dereq_("./util"),_dereq_("./util")),OPMAX=(_require.isWebGLEnabled,1),OPMIN=0;PanoCube.createTextureFromUrl=function(){var _ref2=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee(url){return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",new Promise(function(resolve,reject){(new THREE.TextureLoader).load(url,function(texture){resolve(texture)},void 0,function(err){reject(err)})}));case 1:case"end":return _context.stop()}},_callee)}));return function(){return _ref2.apply(this,arguments)}}(),PanoCube.prototype.update=function(){this.isReady&&(console.log("cube create__________"),this.isReady=!1,this.creatPano(this.img_res))},PanoCube.prototype.loadResource=function(){var _ref3=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee2(preview_img,resolve,reject){var self;return _regenerator["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return self=this,_context2.abrupt("return",Promise.all([PanoCube.createTextureFromUrl(preview_img.right),PanoCube.createTextureFromUrl(preview_img.left),PanoCube.createTextureFromUrl(preview_img.up),PanoCube.createTextureFromUrl(preview_img.down),PanoCube.createTextureFromUrl(preview_img.back),PanoCube.createTextureFromUrl(preview_img.front)]).then(function(res){resolve(res)})["catch"](function(){reject()}));case 2:case"end":return _context2.stop()}},_callee2,this)}));return function(){return _ref3.apply(this,arguments)}}(),PanoCube.preloadResource=function(){var _ref4=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee3(preview_img,img){var self;return _regenerator["default"].wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return self=this,_context3.abrupt("return",Promise.all([PanoCube.createTextureFromUrl(preview_img.right),PanoCube.createTextureFromUrl(preview_img.left),PanoCube.createTextureFromUrl(preview_img.up),PanoCube.createTextureFromUrl(preview_img.down),PanoCube.createTextureFromUrl(preview_img.back),PanoCube.createTextureFromUrl(preview_img.front)]).then(function(res){PanoCube.previewResource=res,PanoCube.currentImg=img})["catch"](function(){}));case 2:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref4.apply(this,arguments)}}(),PanoCube.previewResource,PanoCube.currentImg,PanoCube.prototype.createImg=function(){var _this2=this;this.openPreview&&(this.openPreview=!1,this.image?this.loadResource(this.image,function(res){_this2.img_res=res,_this2.isReady=!0},function(){}):(console.log("this.image PanoCube.currentImg:",PanoCube.currentImg),this.loadResource(PanoCube.currentImg,function(res){_this2.img_res=res,_this2.isReady=!0},function(){})))},PanoCube.prototype.creatPano=function(){var _ref5=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee4(textures){var materials,i,mat,mesh,self,_this3=this;return _regenerator["default"].wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:for(materials=[],i=0;6>i;i++)mat=new THREE.MeshBasicMaterial({map:textures[i]}),mat.transparent=!0,mat.blending=THREE.NormalBlending,mat.opacity=1,materials.push(mat);mesh=new THREE.Mesh(new THREE.BoxBufferGeometry(1050,1050,1050),materials),mesh.geometry.scale(-1,1,1),this.initMesh?(this.sceneMesh=mesh,console.log("sceneMesh mesh")):(console.log("this.initMesh init"),this.initMesh=mesh),this.photoGroup.add(mesh),this.isInit&&(console.log("is init"),this.isInit=!1,self=this,this.image?this.loadResource(this.image,function(res){_this3.creatPano(res),self.resolve()},function(){}):(console.log("is init load current img"),this.loadResource(PanoCube.currentImg,function(res){_this3.creatPano(res),self.resolve()},function(){})));case 7:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref5.apply(this,arguments)}}(),PanoCube.prototype.fadeMesh=function(val){this.sceneMesh?(this.sceneMesh.material.forEach(function(v){v.opacity=val.opacity}),this.initMesh.material.forEach(function(v){v.opacity=val.opacity})):this.initMesh.material.forEach(function(v){v.opacity=val.opacity})},PanoCube.prototype.fadeIn=function(mComplete){var _this4=this,from={opacity:OPMIN},self=this,tw=new TWEEN.Tween(from);return new Promise(function(res){tw.to({opacity:OPMAX},1e3).easing(TWEEN.Easing.Linear.None).onUpdate(function(){self.fadeMesh(from)}).onComplete(function(){res(),self.resolve(),_this4.createImg(),mComplete&&mComplete()}).start()})},PanoCube.prototype.fadeOut=function(mComplete){var self=this,from={opacity:OPMAX},cubetw=new TWEEN.Tween(from);return new Promise(function(res){cubetw.to({opacity:OPMIN},1e3).easing(TWEEN.Easing.Linear.None).onUpdate(function(){self.fadeMesh(from)}).onComplete(function(){res(),mComplete&&mComplete()}).start()})},PanoCube.prototype.dispose=function(){this.sceneMesh&&(this.photoGroup.remove(this.sceneMesh),this.deleteMesh(this.sceneMesh)),this.initMesh&&(this.deleteMesh(this.initMesh),this.photoGroup.remove(this.initMesh))},PanoCube.prototype.deleteGroup=function(group){var _this5=this;group&&group.traverse(function(item){(item instanceof THREE.Mesh||item instanceof THREE.Sprite)&&_this5.deleteMesh(item)})},PanoCube.prototype.deleteMesh=function(item){item.geometry.dispose(),item.material instanceof Array?item.material.forEach(function(m){m.opacity=0,m.dispose()}):item.material.dispose()},module.exports=PanoCube},{"./eyes":12,"./util":27,"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5,"tween.js":9}],20:[function(_dereq_,module){"use strict";function PanoSphere(_ref){var scene=_ref.scene,camera=_ref.camera,isInit=_ref.isInit,openPreview=_ref.openPreview,image=_ref.image,preview_img=_ref.preview_img,resolve=_ref.resolve,reject=_ref.reject,_ref$options=_ref.options,options=void 0===_ref$options?{}:_ref$options;this.isInit=isInit,this.scene=scene,this.camera=camera,this.image=image,this.preview_img=preview_img,this.resolve=resolve,this.reject=reject,this.openPreview=openPreview,this.photoGroup=this.scene.getObjectByName("photo"),this.options=Object.assign({radius:RADIUS,phiOffset:Math.PI/2,thetaOffset:0,phiSegments:360,thetaSegments:6*window.devicePixelRatio,phiSegmentsOfPiece:20,thetaSegmentsOfPiece:20,playStartAni:!1},options),this.creatPano(openPreview?this.preview_img:this.image)}var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(_dereq_("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/asyncToGenerator")),TWEEN=(_dereq_("./eyes"),_dereq_("tween.js")),_require=(_dereq_("./util"),_dereq_("./util")),DBIR=(_require.isWebGLEnabled,1),RADIUS=500;PanoSphere.createTextureFromUrl=function(){var _ref2=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee(url){return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",new Promise(function(resolve,reject){(new THREE.TextureLoader).load(url,function(texture){resolve(texture)},void 0,function(err){reject(err)})}));case 1:case"end":return _context.stop()}},_callee)}));return function(){return _ref2.apply(this,arguments)}}(),PanoSphere.preloadResource=function(){var _ref3=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee2(preview_img,img){return _regenerator["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",PanoSphere.createTextureFromUrl(preview_img).then(function(res){PanoSphere.previewResource=res,img&&(PanoSphere.currentImg=img)})["catch"](function(){console.log("PanoSphere.previewResource error")}));case 1:case"end":return _context2.stop()}},_callee2)}));return function(){return _ref3.apply(this,arguments)}}(),PanoSphere.previewResource,PanoSphere.currentImg,PanoSphere.prototype.creatPano=function(img){var textures,image=img;image?(textures=(new THREE.TextureLoader).load(image),this.resolve()):(textures=PanoSphere.previewResource,this.resolve());var material=new THREE.MeshBasicMaterial({map:textures});material.transparent=!0,material.depthWrite=!1,material.opacity=1;var geometry=new THREE.SphereBufferGeometry(this.options.radius+DBIR,this.options.phiSegments,this.options.thetaSegments,this.options.phiOffset);geometry.scale(-1,1,1);var mesh=new THREE.Mesh(geometry,material);this.initMesh?this.sceneMesh=mesh:this.initMesh=mesh,this.photoGroup.add(mesh),this.isInit&&this.openPreview&&(this.isInit=!1,this.image?this.creatPano(this.image):PanoSphere.currentImg&&this.creatPano(PanoSphere.currentImg))},PanoSphere.prototype.fadeMesh=function(val){this.sceneMesh&&(this.sceneMesh.material.opacity=val.opacity),this.initMesh&&(this.initMesh.material.opacity=val.opacity)},PanoSphere.prototype.fadeIn=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee3(){var move,from,tw,_this=this;return _regenerator["default"].wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return move=this.camera.target.clone().setLength(100),from={opacity:0},tw=new TWEEN.Tween(from),_context3.abrupt("return",new Promise(function(res){tw.to({opacity:1},500).easing(TWEEN.Easing.Linear.None).onUpdate(function(){_this.fadeMesh(from)}).onComplete(function(){res(),_this.openPreview&&(_this.openPreview=!1,_this.creatPano(_this.image?_this.image:PanoSphere.currentImg))}).start()}));case 4:case"end":return _context3.stop()}},_callee3,this)})),PanoSphere.prototype.fadeOut=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee4(){var from,cubetw,_this2=this;return _regenerator["default"].wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return from={opacity:1},this.sceneMesh?(this.sceneMesh.renderOrder=2,this.initMesh.renderOrder=2):this.initMesh.renderOrder=2,cubetw=new TWEEN.Tween(from),_context4.abrupt("return",new Promise(function(res){cubetw.to({opacity:0},500).easing(TWEEN.Easing.Linear.None).onUpdate(function(){_this2.fadeMesh(from)}).onComplete(function(){_this2.dispose(),res()}).start()}));case 4:case"end":return _context4.stop()}},_callee4,this)})),PanoSphere.prototype.dispose=function(){this.sceneMesh&&(this.photoGroup.remove(this.sceneMesh),this.deleteMesh(this.sceneMesh)),this.initMesh&&(this.deleteMesh(this.initMesh),this.photoGroup.remove(this.initMesh))},PanoSphere.prototype.deleteGroup=function(group){var _this3=this;group&&group.traverse(function(item){(item instanceof THREE.Mesh||item instanceof THREE.Sprite)&&_this3.deleteMesh(item)})},PanoSphere.prototype.deleteMesh=function(item){item.geometry.dispose(),item.material.dispose()},PanoSphere.prototype.update=function(){},module.exports=PanoSphere},{"./eyes":12,"./util":27,"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5,"tween.js":9}],21:[function(_dereq_,module){"use strict";function PanoTiled(_ref){var _this=this,scene=_ref.scene,camera=_ref.camera,reject=_ref.reject,resolve=_ref.resolve,configData=_ref.configData,resourceRoot=_ref.resourceRoot,_ref$options=_ref.options,options=void 0===_ref$options?{}:_ref$options;this.scene=scene,this.reject=reject,this.resolve=resolve,this.photoGroup=scene.getObjectByName("photo"),this.camera=camera,this.configData=configData,this.resourceRoot=resourceRoot,this.isReady=!1,this.initLoaded=!1,this.raycaster=new THREE.Raycaster,this.options=Object.assign({radius:RADIUS,phiOffset:Math.PI/2,thetaOffset:0,phiSegments:360,thetaSegments:6*window.devicePixelRatio,phiSegmentsOfPiece:15,thetaSegmentsOfPiece:15,showWireFrame:!1,autoLoadTile:!0,playStartAni:!1,northFix:0},options),this.autoLoadTile=this.options.autoLoadTile,this.canLoadTile=!1;var meshGroup=new THREE.Group,geometry=new THREE.SphereBufferGeometry(this.options.radius+DBIR,this.options.phiSegments,this.options.thetaSegments,this.options.phiOffset);if(geometry.scale(-1,1,1),configData&&resourceRoot)var thumbUrl=resourceRoot+configData.thumb,texture=(new THREE.TextureLoader).load(thumbUrl,function(){_this.initLoaded=!0,_this.resolve(),_this.isReady=!0,_this.autoLoadTile&&(_this.canLoadTile=!0)},function(){_this.reject()});else{this.initLoaded=!0,this.resolve();var texture=this.currentResource;this.isReady=!0,this.autoLoadTile&&(this.canLoadTile=!0)}var material=new THREE.MeshBasicMaterial({map:texture});material.transparent=!0,material.blending=THREE.NormalBlending;var initMesh=new THREE.Mesh(geometry,material);if(this.options.showWireFrame){var lseg=this.createLineSeg(geometry);this.photoGroup.add(lseg),this.lseg=lseg}this.photoGroup.add(initMesh),this.photoGroup.add(meshGroup),this.initMesh=initMesh,this.meshGroup=meshGroup}var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(_dereq_("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/asyncToGenerator")),TWEEN=(_dereq_("./eyes"),_dereq_("tween.js")),Util=_dereq_("./util"),_require=_dereq_("es6-promise"),Promise=_require.Promise,DBIR=50,RADIUS=500,OPMAX=1,OPMIN=0;PanoTiled.loadTileResource=function(){var _ref2=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee2(resourceRoot){return _regenerator["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.prev=0,_context2.abrupt("return",new Promise(function(){var _ref3=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee(resolve,reject){var url,xhr;return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:url=resourceRoot+"config.json",xhr=new XMLHttpRequest,xhr.open("GET",url,!0),xhr.send(null),xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var res=xhr.responseText;if("{"==res[0]){var data_res=JSON.parse(res);resolve(data_res)}else resolve(self.decodeConfig(res,"liujiangtao11@jd.com"))}else xhr.status>=400&&reject()};case 5:case"end":return _context.stop()}},_callee)}));return function(){return _ref3.apply(this,arguments)}}()));case 4:throw _context2.prev=4,_context2.t0=_context2["catch"](0),console.error("loadTileResource",_context2.t0),_context2.t0;case 8:case"end":return _context2.stop()}},_callee2,null,[[0,4]])}));return function(){return _ref2.apply(this,arguments)}}(),PanoTiled.prototype.preloadResource=function(){var _ref4=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee3(resourceRoot){var configData,_this2=this;return _regenerator["default"].wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return resourceRoot+="/",this.resourceRoot=resourceRoot,_context3.next=4,PanoTiled.loadTileResource(this.resourceRoot);case 4:return configData=_context3.sent,this.configData=configData,_context3.abrupt("return",new Promise(function(res,rej){var thumbUrl=_this2.resourceRoot+configData.thumb;(new THREE.TextureLoader).load(thumbUrl,function(texture){_this2.currentResource=texture,res()},function(){rej()})}));case 7:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref4.apply(this,arguments)}}(),PanoTiled.preloadPanoResource=function(){var _ref5=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee4(resourceRoot){var configData;return _regenerator["default"].wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return resourceRoot+="/",_context4.next=3,PanoTiled.loadTileResource(resourceRoot);case 3:return configData=_context4.sent,_context4.abrupt("return",new Promise(function(res,rej){var thumbUrl=resourceRoot+configData.thumb;(new THREE.TextureLoader).load(thumbUrl,function(texture){res({resourceRoot:resourceRoot,configData:configData,texture:texture})},function(){rej()})}));case 5:case"end":return _context4.stop()}},_callee4)}));return function(){return _ref5.apply(this,arguments)}}(),PanoTiled.prototype.createLineSeg=function(geometry){var wfgeo=new THREE.WireframeGeometry(geometry),lineMaterial=new THREE.LineBasicMaterial({color:16777215,opacity:.5}),lineSegs=new THREE.LineSegments(wfgeo,lineMaterial);return lineSegs},PanoTiled.prototype._isPieceInViewport=function(piece){var target=this.camera.target,degToRad=THREE.Math.degToRad,pieceCenterPhi=degToRad(piece.phiStart+piece.phiLength/2),pieceCenterTheta=degToRad(piece.thetaStart+piece.thetaLength/2),piecePosition=new THREE.Vector3(500*Math.sin(pieceCenterTheta)*Math.cos(pieceCenterPhi),500*Math.cos(pieceCenterTheta),500*Math.sin(pieceCenterTheta)*Math.sin(pieceCenterPhi)),angle=target.angleTo(piecePosition),maxAngle=Math.max(degToRad(fov/2),degToRad(fovH/2));return maxAngle>=angle?!0:!1},PanoTiled.prototype.isPieceInViewport=function(piece){var degToRad=THREE.Math.degToRad,ps=degToRad(piece.phiStart)+this.options.phiOffset;+this.options.northFix;var pl=degToRad(piece.phiLength),ts=degToRad(piece.thetaStart),tl=degToRad(piece.thetaLength),r=this.options.radius,tlp=new THREE.Vector3(r*Math.sin(ts)*Math.cos(ps),r*Math.cos(ts),r*Math.sin(ts)*Math.sin(ps));if(this.isPointInViewport(tlp))return!0;var trp=new THREE.Vector3(r*Math.sin(ts)*Math.cos(ps+pl),r*Math.cos(ts),r*Math.sin(ts)*Math.sin(ps+pl));if(this.isPointInViewport(trp))return!0;var blp=new THREE.Vector3(r*Math.sin(ts+tl)*Math.cos(ps),r*Math.cos(ts+tl),r*Math.sin(ts+tl)*Math.sin(ps));if(this.isPointInViewport(blp))return!0;var brp=new THREE.Vector3(r*Math.sin(ts+tl)*Math.cos(ps+pl),r*Math.cos(ts+tl),r*Math.sin(ts+tl)*Math.sin(ps+pl));return this.isPointInViewport(brp)?!0:!1},PanoTiled.prototype.isPointInViewport=function(vec){var tempV=vec.applyMatrix4(this.camera.matrixWorldInverse).applyMatrix4(this.camera.projectionMatrix);return Math.abs(tempV.x)>1||Math.abs(tempV.y)>1||Math.abs(tempV.z)>1?!1:!0},PanoTiled.prototype.createPanoMesh=function(){var _ref6=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee5(pieces){var degToRad,_loop,i,_this3=this;return _regenerator["default"].wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:degToRad=THREE.Math.degToRad,_loop=_regenerator["default"].mark(function _loop(i){var piece,geo,imgId,imgUrl;return _regenerator["default"].wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(piece=pieces[i],piece.added=!0,geo=new THREE.SphereBufferGeometry(_this3.options.radius,_this3.options.phiSegmentsOfPiece,_this3.options.thetaSegmentsOfPiece,degToRad(piece.phiStart)+_this3.options.phiOffset,degToRad(piece.phiLength),degToRad(piece.thetaStart),degToRad(piece.thetaLength)),geo.scale(-1,1,1),imgId=piece.id||"".concat(piece.thetaIndex,"_").concat(piece.phiIndex),imgUrl="".concat(_this3.resourceRoot).concat(imgId,".").concat(_this3.configData.fileType||"jpg"),512===piece.width&&512==piece.height){_context5.next=10;break}return _context5.next=9,Util.resizeImage(imgUrl,512,512,"image/jpg","blobUrl");case 9:imgUrl=_context5.sent;case 10:(new THREE.TextureLoader).load(imgUrl,function(tx){/^blob/.test(imgUrl)&&URL.revokeObjectURL(imgUrl),_this3.configData.pieces[_this3.configData.pieces.length-1].thetaIndex==piece.thetaIndex&&(tx.minFilter=THREE.NearestFilter);var material=new THREE.MeshBasicMaterial({map:tx});material.transparent=!0,material.blending=THREE.NormalBlending;var tmesh=new THREE.Mesh(geo,material);tmesh&&_this3.meshGroup&&(_this3.meshGroup.add(tmesh),_this3.options.showWireFrame&&_this3.meshGroup.add(_this3.createLineSeg(geo)))});case 11:case"end":return _context5.stop()}},_loop)}),i=0;case 3:if(!(i<pieces.length)){_context6.next=8;break}return _context6.delegateYield(_loop(i),"t0",5);case 5:i++,_context6.next=3;break;case 8:case"end":return _context6.stop()}},_callee5)}));return function(){return _ref6.apply(this,arguments)}}(),PanoTiled.prototype.loadPiecesInViewport=function(){var _this4=this;if(this.configData){var pieces=this.configData.pieces,unloadpieces=pieces.filter(function(v){return!v.added});unloadpieces.length||this.isAllLoad||(this.isAllLoad=!0),unloadpieces=unloadpieces.filter(function(v){return _this4.isPieceInViewport(v);

}),this.createPanoMesh(unloadpieces)}},PanoTiled.prototype.update=function(){this.isReady&&this.canLoadTile&&this.loadPiecesInViewport()},PanoTiled.prototype.fadeMesh=function(val){this.initMesh&&(this.initMesh.material.opacity=val.opacity),this.meshGroup&&this.meshGroup.children.forEach(function(v){v.material.opacity=val.opacity})},PanoTiled.prototype.fadeIn=function(mComplete){var _this5=this,from=(this.camera.target.clone().setLength(100),{opacity:OPMIN,filter:"blur(10px)"}),title_in=new TWEEN.Tween(from);return new Promise(function(res){title_in.to({opacity:OPMAX,filter:"blur(0px)"},1e3).easing(TWEEN.Easing.Linear.None).onUpdate(function(){_this5.fadeMesh(from)}).onComplete(function(){res(),mComplete&&mComplete()}).start()})},PanoTiled.prototype.fadeOut=function(mComplete){var _this6=this,from={opacity:OPMAX,filter:"blur(0px)"};this.initMesh.renderOrder=1,this.meshGroup.renderOrder=1;var title_out=new TWEEN.Tween(from);return new Promise(function(res){title_out.to({opacity:OPMIN,filter:"blur(10px)"},1e3).easing(TWEEN.Easing.Linear.None).onUpdate(function(){_this6.fadeMesh(from)}).onComplete(function(){mComplete&&mComplete(),res()}).start()})},PanoTiled.prototype.dispose=function(){this.initMesh&&(this.initMesh.geometry.dispose(),this.initMesh.material.dispose(),this.photoGroup.remove(this.initMesh)),this.meshGroup&&(this.meshGroup.children.forEach(function(v){v.geometry.dispose(),v.material.dispose()}),this.photoGroup.remove(this.meshGroup)),this.initMesh=null,this.meshGroup=null},module.exports=PanoTiled},{"./eyes":12,"./util":27,"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5,"es6-promise":6,"tween.js":9}],22:[function(_dereq_,module){"use strict";function PanoramaRenderer(scene,camera,options){this.initOptions=options,this.scene=scene,this.mesh=null,this.camera=camera,this.photoGroup=this.scene.getObjectByName("photo"),this.options=Object.assign({radius:500,phiOffset:Math.PI/2,thetaOffset:0,phiSegments:80,thetaSegments:60,phiSegmentsOfPiece:20,thetaSegmentsOfPiece:20,showWireFrame:!1,autoLoadTile:!0},{}),this.DBIR=10,this.isReady=!1,this.isAllLoad=!1,this.configData=null,this.autoLoadTile=this.options.autoLoadTile,this.meshGroup=null,this.isAnimating=!1,this.currentCameraState={fov:75,lat:0,lon:0,pos:0},this.sceneParam=null}var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(_dereq_("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/asyncToGenerator")),Eyes=(_dereq_("eventemitter3"),_dereq_("./eyes")),TWEEN=_dereq_("tween.js"),Util=_dereq_("./util"),PanoTiled=_dereq_("./pano-tiled"),PanoCube=_dereq_("./pano-cube"),PanoSphere=_dereq_("./pano-sphere");PanoramaRenderer.prototype.destroyScene=function(){var _ref=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee(createNewScene){var p1,p2;return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(this.pano){_context.next=2;break}return _context.abrupt("return");case 2:return this.lastPano=this.pano,this.pano=createNewScene(),p1=this.lastPano.fadeOut(),p2=this.pano.fadeIn(),_context.next=8,Promise.all([p1,p2]);case 8:this.lastPano&&this.lastPano.dispose(),this.lastPano=null;case 10:case"end":return _context.stop()}},_callee,this)}));return function(){return _ref.apply(this,arguments)}}(),PanoramaRenderer.prototype.createPano=function(){var _ref2=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee3(data,isInit,isPlayPlanet){var self,params;return _regenerator["default"].wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return self=this,params={isStereo:data.isStereo},this.sceneParam=data,_context3.abrupt("return",new Promise(function(){var _ref3=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee2(resolve,reject){return _regenerator["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(data.panoramaType){_context2.next=5;break}if("1"!=data.loadType){_context2.next=4;break}return _context2.next=4,self.creatTiles(data,isInit,resolve,reject);case 4:isInit&&(isPlayPlanet?self.playStartAni(self.sceneParam):self.pano.canLoadTile=!0);case 5:_context2.t0=data.panoramaType,_context2.next="sphere"===_context2.t0?8:"cube"===_context2.t0?17:21;break;case 8:if("1"!=data.loadType){_context2.next=13;break}return _context2.next=11,self.creatTiles(data,isInit,resolve,reject);case 11:_context2.next=15;break;case 13:return _context2.next=15,self.creatSphere(data,isInit,resolve,reject);case 15:return isInit&&(isPlayPlanet?self.playStartAni(self.sceneParam):self.pano.canLoadTile=!0),_context2.abrupt("break",22);case 17:return _context2.next=19,self.creatCube(data,isInit,resolve,reject);case 19:return _context2.abrupt("break",22);case 21:return _context2.abrupt("break",22);case 22:case"end":return _context2.stop()}},_callee2)}));return function(){return _ref3.apply(this,arguments)}}()));case 4:case"end":return _context3.stop()}},_callee3,this)}));return function(){return _ref2.apply(this,arguments)}}(),PanoramaRenderer.prototype.creatCube=function(){var _ref4=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee4(data,isInit,resolve,reject){var self;return _regenerator["default"].wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return self=this,_context4.next=3,PanoCube.preloadResource(data.imagePreview,data.image);case 3:if(isInit){_context4.next=6;break}return this.destroyScene(function(){return self.pano=new PanoCube({scene:self.scene,camera:self.camera,openPreview:!0,reject:reject,resolve:resolve,isInit:isInit}),self.pano}),_context4.abrupt("return");case 6:self.pano=new PanoCube({scene:self.scene,camera:self.camera,openPreview:!0,reject:reject,resolve:resolve,isInit:isInit});case 7:case"end":return _context4.stop()}},_callee4,this)}));return function(){return _ref4.apply(this,arguments)}}(),PanoramaRenderer.prototype.creatSphere=function(){var _ref5=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee5(data,isInit,resolve,reject){var self;return _regenerator["default"].wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return self=this,_context5.next=3,PanoSphere.preloadResource(data.image,data.image);case 3:if(isInit){_context5.next=6;break}return this.destroyScene(function(){return self.pano=new PanoSphere({scene:self.scene,camera:self.camera,openPreview:!0,reject:reject,resolve:resolve,isInit:isInit}),self.pano}),_context5.abrupt("return");case 6:self.pano=new PanoSphere({scene:self.scene,camera:self.camera,openPreview:!0,reject:reject,resolve:resolve,isInit:isInit});case 7:case"end":return _context5.stop()}},_callee5,this)}));return function(){return _ref5.apply(this,arguments)}}(),PanoramaRenderer.prototype.creatTiles=function(){var _ref6=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee6(data,isInit,resolve,reject){var panoResourceData,_this=this;return _regenerator["default"].wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,PanoTiled.preloadPanoResource(data.imagePreview);case 2:if(panoResourceData=_context6.sent,isInit){_context6.next=6;break}return this.destroyScene(function(){return _this.pano=new PanoTiled({scene:_this.scene,reject:reject,resolve:resolve,camera:_this.camera,resourceRoot:panoResourceData.resourceRoot,configData:panoResourceData.configData,options:{autoLoadTile:isInit===!0?!1:!0,phiOffset:Math.PI/2,northFix:_this.sceneParam.northFix||0}}),_this.pano}),_context6.abrupt("return");case 6:this.pano=new PanoTiled({scene:this.scene,reject:reject,resolve:resolve,camera:this.camera,resourceRoot:panoResourceData.resourceRoot,configData:panoResourceData.configData,options:{autoLoadTile:isInit===!0?!1:!0,phiOffset:Math.PI/2,imagePreview:data.imagePreview}});case 7:case"end":return _context6.stop()}},_callee6,this)}));return function(){return _ref6.apply(this,arguments)}}(),PanoramaRenderer.prototype.playStartAni=function(sceneParam){var planet_from={fov:135,lat:-90,lon:90,pos:-500},FixedLon=sceneParam.FixedLon?sceneParam.FixedLon:270,FixedLat=sceneParam.FixedLat?sceneParam.FixedLat:0,detLon=270-FixedLon,last_Lon=270;detLon>0?(last_Lon=detLon,planet_from.lon=last_Lon-180):(last_Lon=360-FixedLon+270,planet_from.lon=450-FixedLon);var normal_to={fov:this.initOptions.fov||75,lat:FixedLat,lon:last_Lon,pos:0};this.animateViewAngle(planet_from,normal_to,3e3)},PanoramaRenderer.prototype.animateViewAngle=function(from,to,time){var _this2=this;this.isAnimating=!0,from=Object.assign({},from),to=Object.assign({},to);var tw=new TWEEN.Tween(from);return new Promise(function(res){tw.to(to,time).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){Object.assign(_this2.currentCameraState,from),_this2.updateCamera(_this2.currentCameraState)}).onComplete(function(){_this2.isAnimating=!1,_this2.pano&&(_this2.pano.canLoadTile=!0),_this2.isReady=!0,res()}).start()})},PanoramaRenderer.prototype.updateCamera=function(state){if(this.isAnimating){var camera=this.camera;camera.fov=state.fov;var lat=Math.max(-88,Math.min(88,state.lat));state.lat=lat;var thetaDeg=90-lat,phiDeg=state.lon%360;this.theta=THREE.Math.degToRad(thetaDeg),this.phi=THREE.Math.degToRad(phiDeg),camera.target.x=500*Math.sin(this.theta)*Math.cos(this.phi),camera.target.y=500*Math.cos(this.theta),camera.target.z=500*Math.sin(this.theta)*Math.sin(this.phi);var cp=camera.target.clone().setLength(Math.abs(state.pos));state.pos<0&&(cp=cp.negate()),camera.position.copy(cp),camera.lookAt(camera.target),camera.updateProjectionMatrix()}},PanoramaRenderer.prototype.update=function(){this.pano&&this.pano.update()},PanoramaRenderer.prototype.decodeConfig=function(config,key){var cfgLength=config.length,offset=this.calcOffset(key),cfg=new Array(cfgLength).fill(0,0,cfgLength).map(function(v,i){return String.fromCharCode(config.charCodeAt(i)-offset)}).join("");return JSON.parse(cfg)},PanoramaRenderer.prototype.calcOffset=function(key){var keyLength=key.length,factor=65535,a=0,b=0,codes=new Array(keyLength).fill(0,0,keyLength).map(function(v,i){return key.charCodeAt(i)});return codes.forEach(function(v,i){i%2?a+=v:b+=v}),a*b%factor},PanoramaRenderer.prototype.loadTileResource=function(){var _ref7=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee7(resourceRoot){var url,self,tile_res;return _regenerator["default"].wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.prev=0,url=resourceRoot+"config.json",self=this,_context7.next=5,$.ajax({url:url,withCredentials:!1,dataType:"text",success:function(res){if("{"==res[0]){var data_res=JSON.parse(res);return console.log("res : ",data_res),data_res}return self.decodeConfig(res,"liujiangtao11@jd.com")},error:function(){}});case 5:return tile_res=_context7.sent,_context7.abrupt("return",tile_res);case 9:throw _context7.prev=9,_context7.t0=_context7["catch"](0),console.error("loadTileResource",_context7.t0),_context7.t0;case 13:case"end":return _context7.stop()}},_callee7,this,[[0,9]])}));return function(){return _ref7.apply(this,arguments)}}(),PanoramaRenderer.prototype.cubeTextureLoad=function(to_load,loadedIndex,loader,textures){if(loadedIndex==to_load.length)return void this.onCubeTextureLoaded_(textures);var self=this;loader.load(to_load[loadedIndex],function(tex){textures.push(tex),self.cubeTextureLoad(to_load,loadedIndex+1,loader,textures)},void 0,this.onCubeTextureError_.bind(this))},PanoramaRenderer.prototype.set360Video=function(videoElement,opt_params){return new Promise(function(resolve,reject){this.resolve=resolve,this.reject=reject;var params=opt_params||{};this.isStereo=!!params.isStereo;var videoTexture=new THREE.VideoTexture(videoElement);videoTexture.minFilter=THREE.LinearFilter,videoTexture.magFilter=THREE.LinearFilter,videoTexture.format=THREE.RGBFormat,videoTexture.generateMipmaps=!1,videoTexture.needsUpdate=!0,this.onTextureLoaded_(videoTexture)}.bind(this))},PanoramaRenderer.prototype.setOpacity=function(opacity,duration){this.scene;return new Promise(function(resolve){window.setTimeout(function(){resolve()},duration)})},PanoramaRenderer.prototype.onTextureLoaded_=function(texture){this.dispose();var sphereLeft,sphereRight;this.isStereo?(sphereLeft=this.createPhotosphere_(texture,{offsetY:.5,scaleY:.5}),sphereRight=this.createPhotosphere_(texture,{offsetY:0,scaleY:.5})):(sphereLeft=this.createPhotosphere_(texture),this.mesh=sphereLeft,Util.isDebug()&&console.log("onTextureLoaded_ is not mesh is null")),sphereLeft.layers.set(Eyes.LEFT),sphereLeft.eye=Eyes.LEFT,this.photoGroup.add(this.mesh),this.resolve()},PanoramaRenderer.prototype.dispose=function(){null!=this.mesh&&(this.mesh.geometry.dispose(),this.mesh.material instanceof Array?this.mesh.material.forEach(function(m){m.dispose()}):this.mesh.material.dispose(),this.photoGroup.remove(this.mesh)),null!=this.meshGroup&&(this.meshGroup.children.forEach(function(v){v.geometry.dispose(),v.material.dispose()}),this.photoGroup.remove(this.meshGroup)),this.mesh=null,this.meshGroup=null},PanoramaRenderer.prototype.onTextureError_=function(){this.reject('Unable to load texture from "'+this.src+'"')},PanoramaRenderer.prototype.onCubeTextureLoaded_=function(texture){this.dispose();var sphereLeft=this.createPhotocube_(texture);this.mesh=sphereLeft,sphereLeft.layers.set(Eyes.LEFT),sphereLeft.eye=Eyes.LEFT,this.photoGroup.add(this.mesh),this.resolve()},PanoramaRenderer.prototype.onCubeTextureError_=function(){this.reject('onCubeTextureError_ Unable to load texture from "'+this.src+'"')},PanoramaRenderer.prototype.onTilesTextureLoaded_=function(texture){this.dispose();var sphereLeft=this.createPhotoTiles(texture);this.mesh=sphereLeft;var meshGroup=new THREE.Group;this.meshGroup=meshGroup,sphereLeft.layers.set(Eyes.LEFT),sphereLeft.eye=Eyes.LEFT,this.photoGroup.add(this.mesh),this.photoGroup.add(this.meshGroup),this.isReady=!0,this.resolve()},PanoramaRenderer.prototype.onTilesTextureError_=function(){this.reject('onTilesTextureError_ Unable to load texture from "'+this.src+'"')},PanoramaRenderer.prototype.createPhotosphere_=function(texture,opt_params){var p=opt_params||{};p.scaleX=p.scaleX||1,p.scaleY=p.scaleY||1,p.offsetX=p.offsetX||0,p.offsetY=p.offsetY||0,p.phiStart=p.phiStart||0,p.phiLength=p.phiLength||2*Math.PI,p.thetaStart=p.thetaStart||0,p.thetaLength=p.thetaLength||Math.PI;var geometry=new THREE.SphereBufferGeometry(500,80,60,p.phiStart,p.phiLength,p.thetaStart,p.thetaLength);geometry.scale(-1,1,1);var material=new THREE.MeshBasicMaterial({map:texture}),out=new THREE.Mesh(geometry,material);return out.name="sphere",out},PanoramaRenderer.prototype.createPhotocube_=function(textures){for(var materials=[],i=0;6>i;i++){var material=new THREE.MeshBasicMaterial({map:textures[i]});materials.push(material)}var geometry=new THREE.BoxBufferGeometry(1e3,1e3,1e3);geometry.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1));var out=new THREE.Mesh(geometry,materials);return out.name="cube",out},PanoramaRenderer.prototype.createPhotoTiles=function(texture){var material=new THREE.MeshBasicMaterial({map:texture}),geometry=new THREE.SphereBufferGeometry(this.options.radius+this.DBIR,this.options.phiSegments,this.options.thetaSegments,this.options.phiOffset);geometry.applyMatrix((new THREE.Matrix4).makeScale(-1,1,1));var out=new THREE.Mesh(geometry,material);return out.name="titles",out},PanoramaRenderer.prototype.loadPiecesInViewport=function(){var _this3=this,pieces=this.configData.pieces,unloadpieces=pieces.filter(function(v){return!v.added});unloadpieces.length||this.isAllLoad||(this.isAllLoad=!0,this.isReady=!1),unloadpieces=unloadpieces.filter(function(v){return _this3.isPieceInViewport(v)}),this.createPanoMesh(unloadpieces)},PanoramaRenderer.prototype.isPieceInViewport=function(piece){var degToRad=THREE.Math.degToRad,ps=degToRad(piece.phiStart)+this.options.phiOffset,pl=degToRad(piece.phiLength),ts=degToRad(piece.thetaStart),tl=degToRad(piece.thetaLength),r=this.options.radius,tlp=new THREE.Vector3(r*Math.sin(ts)*Math.cos(ps),r*Math.cos(ts),r*Math.sin(ts)*Math.sin(ps));if(this.isPointInViewport(tlp))return!0;var trp=new THREE.Vector3(r*Math.sin(ts)*Math.cos(ps+pl),r*Math.cos(ts),r*Math.sin(ts)*Math.sin(ps+pl));if(this.isPointInViewport(trp))return!0;var blp=new THREE.Vector3(r*Math.sin(ts+tl)*Math.cos(ps),r*Math.cos(ts+tl),r*Math.sin(ts+tl)*Math.sin(ps));if(this.isPointInViewport(blp))return!0;var brp=new THREE.Vector3(r*Math.sin(ts+tl)*Math.cos(ps+pl),r*Math.cos(ts+tl),r*Math.sin(ts+tl)*Math.sin(ps+pl));return this.isPointInViewport(brp)?!0:!1},PanoramaRenderer.prototype.isPointInViewport=function(vec){var tempV=vec.applyMatrix4(this.camera.matrixWorldInverse).applyMatrix4(this.camera.projectionMatrix);return Math.abs(tempV.x)>1||Math.abs(tempV.y)>1||Math.abs(tempV.z)>1?!1:!0},PanoramaRenderer.prototype.createPanoMesh=function(pieces){for(var _this4=this,degToRad=THREE.Math.degToRad,_loop=function(i){var piece=pieces[i];piece.added=!0;var geo=new THREE.SphereBufferGeometry(_this4.options.radius,_this4.options.phiSegmentsOfPiece,_this4.options.thetaSegmentsOfPiece,degToRad(piece.phiStart)+_this4.options.phiOffset,degToRad(piece.phiLength),degToRad(piece.thetaStart),degToRad(piece.thetaLength));geo.scale(-1,1,1);var imgId=piece.id||"".concat(piece.thetaIndex,"_").concat(piece.phiIndex),imgUrl="".concat(_this4.resourceRoot).concat(imgId,".").concat(_this4.configData.fileType||"jpg");(new THREE.TextureLoader).load(imgUrl,function(tx){var material=new THREE.MeshBasicMaterial({map:tx}),tmesh=new THREE.Mesh(geo,material);_this4.meshGroup.add(tmesh),console.log(piece.id)})},i=0;i<pieces.length;i++)_loop(i)},PanoramaRenderer.prototype.createOpacityMask_=function(){var geometry=new THREE.SphereGeometry(.49,48,48),material=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,opacity:0,transparent:!0}),opacityMask=new THREE.Mesh(geometry,material);return opacityMask.name="opacityMask",opacityMask.renderOrder=1,this.scene.add(opacityMask),opacityMask},module.exports=PanoramaRenderer},{"./eyes":12,"./pano-cube":19,"./pano-sphere":20,"./pano-tiled":21,"./util":27,"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5,eventemitter3:7,"tween.js":9}],23:[function(_dereq_,module){"use strict";function Player(selector,contentInfo){var _this=this;EventEmitter.call(this);var containerEl=null,selectorStr=selector;"string"!=typeof selector&&(containerEl=selector,selectorStr=contentInfo.selector),this.rendering=!0,this.id="id-"+selectorStr,this.name=selectorStr,this.container=containerEl||document.querySelector("#"+selectorStr),this.loadIndicator=new LoadingIndicator(selectorStr);var worldRenderer=new WorldRenderer(selectorStr,contentInfo,this);if(this.worldRender=worldRenderer,this.isReadySent=!1,worldRenderer.on("load",this.onRenderLoad.bind(this),{}),worldRenderer.on("error",this.onRenderError.bind(this),{}),worldRenderer.on("modechange",this.onModeChange,{}),worldRenderer.hotspotRenderer.on("click",this.onHotspotClick.bind(this),{}),worldRenderer.embedspotRenderer.on("embed-click",this.onEmbedspotClick.bind(this),{}),worldRenderer.embedspotRenderer.on("scene-click",this.onSceneClick.bind(this),{}),worldRenderer.on("cruiseStart",function(e){_this.emit("cruiseStart",e)},{}),worldRenderer.on("cruiseStop",function(e){_this.emit("cruiseStop",e)},{}),worldRenderer.on("touchStart",function(e){_this.emit("touchStart",e)},{}),worldRenderer.on("touchMove",this.onSceneTouchMove.bind(this),{}),worldRenderer.on("touchEnd",this.onSceneTouchEnd.bind(this),{}),worldRenderer.on("compassUpdate",function(e){_this.emit("compassUpdate",e)},{}),!Util.isWebGLEnabled())return void this.showError("WebGL not supported.");var scene=SceneInfo.loadFromAPIParams(contentInfo);worldRenderer.setScene(scene,!0).then(function(){})["catch"](function(err){console.log(err.message)}),scene.isYawOnly&&(WebVRConfig=window.WebVRConfig||{},WebVRConfig.YAW_ONLY=!0),requestAnimationFrame(this.loopRender.bind(this))}var LoadingIndicator=_dereq_("./loading-indicator"),ES6Promise=_dereq_("es6-promise");ES6Promise.polyfill();var SceneInfo=_dereq_("./scene-info"),Util=_dereq_("./util"),WorldRenderer=_dereq_("./world-renderer"),EventEmitter=_dereq_("eventemitter3");Player.prototype=new EventEmitter,Player.prototype.constructor=Player,Player.prototype.onVideoTap=function(){this.worldRender.videoProxy.play(),this.hidePlayButton(),this.container.removeEventListener("touchend",this.onVideoTap)},Player.prototype.onRenderLoad=function(event){event.videoElement&&(Util.isMobile(),this.showPlayButton(),this.container.addEventListener("touchend",this.onVideoTap),event.videoElement.addEventListener("pause",this.onPause),event.videoElement.addEventListener("play",this.onPlay));var worldRender=this.worldRender;!worldRender.sceneInfo.video&&worldRender.sceneInfo.isAutoRotation&&(worldRender.controls.setAutoRotationTime(worldRender.sceneInfo.delayTime,worldRender.sceneInfo.isAutoRotation,worldRender.sceneInfo.cruiseTime),Util.isDebug()&&console.log(" worldRender.sceneInfo.isAutoRotation isAutoRotation")),this.isReadySent?(!worldRender.sceneInfo.video&&worldRender.sceneInfo.isAutoRotation&&worldRender.controls.setAutoRotationTime(worldRender.sceneInfo.delayTime,worldRender.sceneInfo.isAutoRotation),this.emit("loadscene")):(this.emit("ready"),this.isReadySent=!0,console.log("this.loadIndicator.hide()",this.loadIndicator.selector),this.loadIndicator.hide())},Player.prototype.setAutoRotationTime=function(status){var worldRender=this.worldRender;!worldRender.sceneInfo.video&&worldRender.sceneInfo.isAutoRotation?(worldRender.controls.setAutoRotationTime(worldRender.sceneInfo.delayTime,status),Util.isDebug()&&console.log("worldRender.sceneInfo.isAutoRotation isAutoRotation")):Util.isDebug()&&console.log("")},Player.prototype.autoRotationController=function(status){var worldRender=this.worldRender;!worldRender.sceneInfo.video&&worldRender.sceneInfo.isAutoRotation?(worldRender.controls.autoRotationController(status),Util.isDebug()&&console.log(" worldRender.sceneInfo.isAutoRotation autoRotationController")):Util.isDebug()&&console.log("")},Player.prototype.onPlayRequest=function(){var worldRender=this.worldRender;return worldRender.videoProxy?void worldRender.videoProxy.play():void this.onApiError("Attempt to pause, but no video found.")},Player.prototype.onPauseRequest=function(){var worldRender=this.worldRender;return worldRender.videoProxy?void worldRender.videoProxy.pause():void this.onApiError("Attempt to pause, but no video found.")},Player.prototype.onAddHotspot=function(e){Util.isDebug()&&console.log("onAddHotspot",e);parseFloat(e.pitch),parseFloat(e.yaw),parseFloat(e.radius),parseFloat(e.distance),e.id;this.worldRender.hotspotRenderer.add(e)},Player.prototype.onSetContent=function(e){Util.isDebug()&&console.log("onSetContent",e);var worldRender=this.worldRender;worldRender.hotspotRenderer.clearAll(),worldRender.embedspotRenderer.clearAll();var scene=SceneInfo.loadFromAPIParams(e.contentInfo);worldRender.destroy(),Util.isDebug()&&console.log("worldRender.destroy();"),worldRender.setScene(scene,!1).then(function(){console.log("player worldRender setScene OK")})["catch"](function(err){console.log("player worldRender setScene err",err.message)})},Player.prototype.onSetVolume=function(e){var worldRender=this.worldRender;return worldRender.videoProxy?void worldRender.videoProxy.setVolume(e.volumeLevel):void this.onApiError("Attempt to set volume, but no video found.")},Player.prototype.onApiError=function(message){console.error(message),this.emit("error",{message:message})},Player.prototype.onModeChange=function(mode){this.emit("modechange",{mode:mode})},Player.prototype.onEmbedspotClick=function(id){this.emit("embed-click",{params:id})},Player.prototype.onHotspotClick=function(id,e){this.emit("hotspot-click",{params:id},e,this),this.emit("click",{params:id},e,this)},Player.prototype.onSceneTouchMove=function(e){this.hasMove=!0,this.emit("touchMove",e)},Player.prototype.onSceneTouchEnd=function(e,type){this.emit("touchEnd",e,type),"embed"===type||e.target.id!==this.name+"-renderer"||this.hasMove||this.emit("scene-click",e),this.hasMove=!1},Player.prototype.onSceneClick=function(){},Player.prototype.onPlay=function(){this.emit("paused",!1)},Player.prototype.onPause=function(){this.emit("paused",!0)},Player.prototype.onSceneError=function(message){this.showError("Loader: "+message)},Player.prototype.onRenderError=function(message){this.emit("error",message),this.showError("Render: "+message)},Player.prototype.showError=function(){this.loadIndicator.hide()},Player.prototype.hideError=function(){document.getElementById("error")},Player.prototype.showPlayButton=function(){var playButton=document.querySelector("#play-overlay");playButton.classList.add("visible")},Player.prototype.hidePlayButton=function(){var playButton=document.querySelector("#play-overlay");playButton.classList.remove("visible")},Player.prototype.loopRender=function(time){var self=this;(1==window.stopRender||this.rendering)&&(requestAnimationFrame(this.loopRender.bind(this)),self.worldRender.render(time))},Player.prototype.addHotspot=function(hotspotId,params){var data={id:params.id,position:params.position,pitch:params.pitch,width:params.width,height:params.height,yaw:params.yaw,radius:params.radius,distance:params.distance,type:params.type,anchor_type:params.anchor_type,action_type:params.action_type,html:params.html,style:params.style,img_url:params.img_url,sceneId:params.sceneId,parameter:params.parameter};this.onAddHotspot(data)},Player.prototype.play=function(){this.onPlayRequest()},Player.prototype.pause=function(){this.onPauseRequest()},Player.prototype.setContent=function(contentInfo){var data={contentInfo:contentInfo};this.onSetContent(data)},Player.prototype.setVolume=function(volumeLevel){var data={volumeLevel:volumeLevel};this.onSetVolume(data)},Player.prototype.absolutifyPaths_=function(contentInfo){for(var dirName=this.getDirName_(),urlParams=["image","preview","video"],i=0;i<urlParams.length;i++){var name=urlParams[i],path=contentInfo[name];if(path&&Util.isPathAbsolute(path)){var absolute=Util.relativeToAbsolutePath(dirName,path);contentInfo[name]=absolute}}},Player.prototype.getDirName_=function(){var path=window.location.pathname;return path=path.substring(0,path.lastIndexOf("/")),location.protocol+"//"+location.host+path},Player.prototype.startCruise=function(cruiseCircleTime,delayTime){this.worldRender.controls.setAutoRotationTime(1e3*delayTime,!0,cruiseCircleTime)},Player.prototype.stopCruise=function(){this.worldRender.controls.setAutoRotationTime(0,!1)},Player.prototype.lockHorizontal=function(horizontalLockStatus){this.worldRender.controls._toucher.horizontalLock=horizontalLockStatus},Player.prototype.lockVertical=function(verticalLockStatus){this.worldRender.controls._toucher.verticalLock=verticalLockStatus},Player.prototype.startRender=function(){this.rendering=!0,requestAnimationFrame(this.loopRender.bind(this))},Player.prototype.stopRender=function(){this.rendering=!1},module.exports=Player},{"./loading-indicator":15,"./scene-info":25,"./util":27,"./world-renderer":28,"es6-promise":6,eventemitter3:7}],24:[function(_dereq_,module){"use strict";function ReticleRenderer(camera){this.camera=camera,this.reticle=this.createReticle_(),this.reticle.position.z=-.97,camera.add(this.reticle),this.setVisibility(!1)}ReticleRenderer.prototype.setVisibility=function(isVisible){this.reticle.visible=isVisible},ReticleRenderer.prototype.createReticle_=function(){var geometry=new THREE.TorusGeometry(.02,.005,10,20),material=new THREE.MeshBasicMaterial({color:0}),torus=new THREE.Mesh(geometry,material);return torus},module.exports=ReticleRenderer},{}],25:[function(_dereq_,module){"use strict";function SceneInfo(opt_params){var params=opt_params||{};this.panoramaType=params.panoramaType,this.loadType=params.loadType,this.image=params.image,this.width=params.width,this.height=params.height,this.imagePreview=params.imagePreview,this.preview=params.preview,this.video=params.video,this.defaultYaw=THREE.Math.degToRad(params.defaultYaw||0),this.hotSpots=params.hotSpots,this.embedSpots=params.embedSpots,this.isStereo=Util.parseBoolean(params.isStereo),this.isYawOnly=Util.parseBoolean(params.isYawOnly),this.isDebug=Util.parseBoolean(params.isDebug),this.isVROff=Util.parseBoolean(params.isVROff),this.isAutopanOff=Util.parseBoolean(params.isAutopanOff),this.isAutoRotation=Util.parseBoolean(params.isAutoRotation),this.isPlayPlanet=Util.parseBoolean(params.isPlayPlanet),this.delayTime=params.delayTime,this.FixedLat=params.FixedLat,this.FixedLon=params.FixedLon,this.cruiseTime=params.cruiseTime,this.northFix=params.northFix,this.horizontalLock=params.horizontalLock,this.verticalLock=params.verticalLock}var CAMEL_TO_UNDERSCORE={panoramaType:"panorama_type",loadType:"load_type",video:"video",image:"image",imagePreview:"image_preview",preview:"preview",isStereo:"is_stereo",defaultYaw:"default_yaw",isYawOnly:"is_yaw_only",isDebug:"is_debug",isVROff:"is_vr_off",isAutopanOff:"is_autopan_off",isAutoRotation:"is_auto_rotation",delayTime:"delay_time",isPlayPlanet:"is_play_planet",hotSpots:"hot_spots",embedSpots:"embed_spots",width:"width",height:"height",FixedLat:"fixed_lat",FixedLon:"fixed_lon",panoLonOffset:"pano_lon_offset",panoLatOffset:"pano_lat_offset",cruiseTime:"cruise_time",fps:"fps",northFix:"north_fix",horizontalLock:"horizontal_lock",verticalLock:"vertical_lock"};SceneInfo.loadFromGetParams=function(){var params={};for(var camelCase in CAMEL_TO_UNDERSCORE){var underscore=CAMEL_TO_UNDERSCORE[camelCase];params[camelCase]=Util.getQueryParameter(underscore)}var scene=new SceneInfo(params);return scene.isValid()||console.warn("Invalid scene: %s",scene.errorMessage),scene},SceneInfo.loadFromAPIParams=function(underscoreParams){var params={};for(var camelCase in CAMEL_TO_UNDERSCORE){var underscore=CAMEL_TO_UNDERSCORE[camelCase];void 0!==underscoreParams[underscore]&&(params[camelCase]=underscoreParams[underscore])}var scene=new SceneInfo(params);return scene.isValid()||console.warn("Invalid scene: %s",scene.errorMessage),scene},SceneInfo.prototype.isValid=function(){return this.image||this.video?this.image&&this.video?(this.errorMessage="Both image and video URL can't be specified.",!1):this.image&&!this.isValidImage_(this.image)?(this.errorMessage="Invalid image URL: "+this.image,!1):(this.errorMessage=null,!0):(this.errorMessage="Either image or video URL must be specified.",!1)},SceneInfo.prototype.getCurrentUrl=function(){var url=location.protocol+"//"+location.host+location.pathname+"?";for(var camelCase in CAMEL_TO_UNDERSCORE){var underscore=CAMEL_TO_UNDERSCORE[camelCase],value=this[camelCase];void 0!==value&&(url+=underscore+"="+value+"&")}return url.substring(0,url.length-1)},SceneInfo.prototype.isValidImage_=function(){return!0},module.exports=SceneInfo},{}],26:[function(_dereq_,module){"use strict";function Toucher(config,vm){this.config=Object.assign({radius:50,container:document.body,onStart:function(){},onMove:function(){},onEnd:function(){},onChange:function(){}},config),this.rvm=function(){return vm},Util.isDebug()&&console.log("this.config",this.config),this.lat=this.lon=0,this.lastDistance=-1,this.startX=this.startY=0,this.speed={lat:0,lon:0},this.deceleration=.5,this.factor=.2,this.isDragging=!1,this.isZoom=!1,this.hasSpeed=!1,this.currentSpeed={x:0,y:0},this.curAcc={x:0,y:0},this.acceleration=-0.04,this.speedRatio=3,this.lastFrameTime=null,this.lastX=null,this.lastY=null,this.startX=null,this.startY=null,this.startTime=null,this.dx=this.dy=this.dt=null,this.onMouseDownMouseX=0,this.onMouseDownMouseY=0,this.onMouseDownLon=0,this.onMouseDownLat=0,this.bind(),this.slowdown=this.slowdown.bind(this),this.enableInertia=!0,this.enable=!0,
this.pathList=[],this.horizontalLock=config.horizontalLock,this.verticalLock=config.verticalLock}var EventEmitter=_dereq_("eventemitter3"),Util=_dereq_("./util");Toucher.prototype=new EventEmitter,Object.assign=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},Toucher.prototype.bind=function(){var eventContainer=document.querySelector("#"+this.config.selector+"-renderer");this.config.container?Util.isMobile()?(eventContainer.addEventListener("touchstart",this._bindStart=this._onStart.bind(this)),eventContainer.addEventListener("touchmove",this._bindMove=this._onMove.bind(this)),eventContainer.addEventListener("touchend",this._bindEnd=this._onEnd.bind(this))):(eventContainer.addEventListener("mousedown",this._binMouseStart=this._onMouseStart.bind(this),!1),eventContainer.addEventListener("mousemove",this._binMouseMove=this._onMouseMove.bind(this),!1),eventContainer.addEventListener("mouseup",this._binMouseEnd=this._onMouseEnd.bind(this),!1),eventContainer.addEventListener("mousewheel",this._bintMouseWheel=this.onDocumentMouseWheel_.bind(this),!1),eventContainer.addEventListener("MozMousePixelScroll",this._bintMouseWheel=this.onDocumentMouseWheel_.bind(this)["false"])):(console.log("register body event"),document.body.addEventListener("touchstart",this._bindStart=this._onStart.bind(this)),document.body.addEventListener("touchmove",this._bindMove=this._onMove.bind(this),{passive:!1}),document.body.addEventListener("touchend",this._bindEnd=this._onEnd.bind(this)),document.body.addEventListener("mousedown",this._binMouseStart=this._onMouseStart.bind(this),!1),document.body.addEventListener("mousemove",this._binMouseMove=this._onMouseMove.bind(this),!1),document.body.addEventListener("mouseup",this._binMouseEnd=this._onMouseEnd.bind(this),!1),document.body.addEventListener("mousewheel",this._bintMouseWheel=this.onDocumentMouseWheel_.bind(this),!1),document.body.addEventListener("MozMousePixelScroll",this._bintMouseWheel=this.onDocumentMouseWheel_.bind(this)["false"]))},Toucher.prototype.unbind=function(){document.body.removeEventListener("touchstart",this._bindStart),document.body.removeEventListener("touchmove",this._bindMove),document.body.removeEventListener("touchend",this._bindEnd),window.removeEventListener("mousedown",this._binMouseStart),window.removeEventListener("mousemove",this._binMouseMove),window.removeEventListener("mouseup",this._binMouseEnd)},Toucher.prototype.onDocumentMouseWheel_=function(event){if(event.target.id===this.config.selector+"-canvas"){var deltFov=.05*event.deltaY;this.config.onChange({deltaFov:deltFov})}},Toucher.prototype._onMouseStart=function(event){if(this.enable){this.config.onStart(event),Util.isDebug()&&console.log("event.target",event.target),this.isDragging=!0,this.speed={lat:0,lon:0},this.lastDistance=void 0;var clientX=event.clientX||event.touches[0].clientX,clientY=event.clientY||event.touches[0].clientY;this.onMouseDownMouseX=clientX,this.onMouseDownMouseY=clientY,this.onMouseDownLon=this.lon,this.onMouseDownLat=this.lat,this.hasSpeed=!1,this.dx=this.dy=null,this.slowdownId&&cancelAnimationFrame(this.slowdownId)}},Toucher.prototype._onMouseMove=function(event){if(this.enable&&this.rvm().rendering&&this.isDragging){var clientX=event.clientX,clientY=event.clientY;if(this.lastFrameTime){var dx=this.lastX-clientX,dy=clientY-this.lastY,ct=Date.now(),dt=ct-this.lastFrameTime;this.lastX=clientX,this.lastY=clientY,this.lastFrameTime=ct,this.dx=dx,this.dy=dy,this.dt=dt}else this.lastFrameTime=Date.now(),this.lastX=clientX,this.lastY=clientY,this.startX=clientX,this.startY=clientY,this.startTime=this.lastFrameTime;this.horizontalLock||(this.lon=.1*(this.onMouseDownMouseX-clientX)+this.onMouseDownLon),this.verticalLock||(this.lat=.1*(clientY-this.onMouseDownMouseY)+this.onMouseDownLat),this.config.onChange({lat:this.lat,lon:this.lon}),this.config.onMove(event)}},Toucher.prototype._onMouseEnd=function(event){if(this.enable){if(this.isDragging=!1,this.dt){var dx=this.startX-this.lastX,dy=this.lastY-this.startY,dt=this.lastFrameTime-this.startTime,sx=dx/dt*this.speedRatio,sy=dy/dt*this.speedRatio,d=Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2)),ax=dx/d*this.acceleration,ay=dy/d*this.acceleration;isNaN(ax)?this.hasSpeed=!1:(this.currentSpeed={x:sx,y:sy},this.curAcc={x:ax,y:ay},this.hasSpeed=!0)}this.dx=this.dy=this.dt=this.lastFrameTime=this.lastX=this.lastY=null,this.enableInertia&&this.slowdown(),this._inertance(),this.config.onEnd(event)}},Toucher.prototype.slowdown=function(){if(this.hasSpeed){this.slowdownId=requestAnimationFrame(this.slowdown);var hasXspeed=!0,hasYspeed=!0;Math.abs(this.curAcc.x)>=Math.abs(this.currentSpeed.x)?(this.currentSpeed.x=0,this.curAcc.x=0,hasXspeed=!1):(this.currentSpeed.x+=this.curAcc.x,this.horizontalLock||(this.lon+=.1*this.currentSpeed.x)),Math.abs(this.curAcc.y)>=Math.abs(this.currentSpeed.y)?(this.currentSpeed.y=0,this.curAcc.y=0,hasYspeed=!1):(this.currentSpeed.y+=this.curAcc.y,this.verticalLock||(this.lat+=.1*this.currentSpeed.y)),hasXspeed||hasYspeed?this.config.onChange({isUserInteracting:!1,lat:this.lat,lon:this.lon}):(this.hasSpeed=!1,this.slowdownId&&cancelAnimationFrame(this.slowdownId),this.slowdownId=null)}},Toucher.prototype._onStart=function(event){if(this.enable){if(this.config.onStart(event),this.isDragging=!0,1==event.touches.length){this.isDragging=!0;var clientX=event.clientX||event.touches[0].clientX,clientY=event.clientY||event.touches[0].clientY;this.onMouseDownMouseX=clientX,this.onMouseDownMouseY=clientY,this.onMouseDownLon=this.lon,this.onMouseDownLat=this.lat}if(2==event.touches.length){this.isZoom=!0;var pos0=this.mousePosition(event.touches[0]);this.startX=pos0.x,this.startY=pos0.y;var pos1=this.mousePosition(event.touches[1]);this.startX+=.5*(pos1.x-pos0.x),this.startY+=.5*(pos1.y-pos0.y),this.lastDistance=Math.sqrt((pos0.x-pos1.x)*(pos0.x-pos1.x)+(pos0.y-pos1.y)*(pos0.y-pos1.y))}this.hasSpeed=!1,this.dx=this.dy=null,this.slowdownId&&cancelAnimationFrame(this.slowdownId)}},Toucher.prototype.mousePosition=function(event){var bounds=document.body.getBoundingClientRect(),pos={};return pos.x=event.clientX-bounds.left,pos.y=event.clientY-bounds.top,pos},Toucher.prototype._onMove=function(event){if(this.enable&&this.isDragging){{event.changedTouches[0]}switch(event.touches.length){case 1:if(this.isZoom)return;event.preventDefault();var clientX=event.clientX||event.touches[0].clientX,clientY=event.clientY||event.touches[0].clientY;if(this.horizontalLock||(this.lon=(this.onMouseDownMouseX-clientX)*this.factor+this.onMouseDownLon),this.verticalLock||(this.lat=(clientY-this.onMouseDownMouseY)*this.factor+this.onMouseDownLat),this.lastFrameTime){var dx=this.lastX-clientX,dy=clientY-this.lastY,ct=Date.now(),dt=ct-this.lastFrameTime;this.lastX=clientX,this.lastY=clientY,this.lastFrameTime=ct,this.dx=dx,this.dy=dy,this.dt=dt}else this.lastFrameTime=Date.now(),this.lastX=clientX,this.lastY=clientY,this.startX=clientX,this.startY=clientY,this.startTime=this.lastFrameTime;this.config.onChange({lat:this.lat,lon:this.lon});break;case 2:var pos0=this.mousePosition(event.touches[0]),clientX=pos0.x,clientY=pos0.y;if(-1!=this.lastDistance){var pos1=this.mousePosition(event.touches[1]);clientX+=.5*(pos1.x-pos0.x),clientY+=.5*(pos1.y-pos0.y);var clientDist=Math.sqrt((pos0.x-pos1.x)*(pos0.x-pos1.x)+(pos0.y-pos1.y)*(pos0.y-pos1.y)),deltFov=.1*(this.lastDistance-clientDist);this.config.onChange({deltaFov:deltFov}),this.lastDistance=clientDist}}this.config.onMove(event)}},Toucher.prototype._onEnd=function(event){if(this.enable){if(this.isDragging=!1,this.dt&&!this.isZoom){var dx=this.startX-this.lastX,dy=this.lastY-this.startY,dt=this.lastFrameTime-this.startTime,sx=dx/dt*this.speedRatio,sy=dy/dt*this.speedRatio,d=Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2)),ax=dx/d*this.acceleration,ay=dy/d*this.acceleration;isNaN(ax)?this.hasSpeed=!1:(this.currentSpeed={x:sx,y:sy},this.curAcc={x:ax,y:ay},this.hasSpeed=!0),this.pathList=[]}this.isZoom&&0==event.touches.length&&(this.isZoom=!1,event.preventDefault()),this.isDragging=!1,this.dx=this.dy=this.dt=this.lastFrameTime=this.lastX=this.lastY=null,this.enableInertia&&this.slowdown(),this.lastDistance=-1,this._inertance(),this.config.onEnd(event)}},Toucher.prototype._subSpeed=function(speed){return 0!==speed&&(speed>0?(speed-=this.deceleration,0>speed&&(speed=0)):(speed+=this.deceleration,speed>0&&(speed=0))),speed},Toucher.prototype._inertance=function(){var speed=this.speed;speed.lat=this._subSpeed(speed.lat),speed.lon=this._subSpeed(speed.lon),this.lat-=speed.lat,this.lon+=speed.lon,this.config.onChange({isUserInteracting:!1,speed:speed,lat:this.lat,lon:this.lon}),0===speed.lat&&0===speed.lon?(this._intFrame&&cancelAnimationFrame(this._intFrame),this._intFrame=0):this._intFrame=requestAnimationFrame(this._inertance.bind(this))},Toucher.prototype.reset=function(){this.lat=this.lon=0,this.lastDistance=-1,this.startX=this.startY=0,this.speed={lat:0,lon:0},this.deceleration=.5,this.factor=.2,this.isDragging=!1,this.isZoom=!1,this.onMouseDownMouseX=0,this.onMouseDownMouseY=0,this.onMouseDownLon=0,this.onMouseDownLat=0},module.exports=Toucher},{"./util":27,eventemitter3:7}],27:[function(_dereq_,module){"use strict";var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(_dereq_("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/asyncToGenerator")),Util=window.Util||{};Util.loadImage=function(){var _ref=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee(url){return _regenerator["default"].wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",new Promise(function(res,rej){var img=new Image;img.crossOrigin="anonymous",img.onload=function(){res(img)},img.onerror=function(err){rej(err)},img.src=url}));case 1:case"end":return _context.stop()}},_callee)}));return function(){return _ref.apply(this,arguments)}}(),Util.resizeImage=function(){var _ref2=_asyncToGenerator2["default"](_regenerator["default"].mark(function _callee2(url,dw,dh){var type,ot,img,canv,ctx,_args2=arguments;return _regenerator["default"].wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return type=_args2.length>3&&void 0!==_args2[3]?_args2[3]:"image/jpg",ot=_args2.length>4&&void 0!==_args2[4]?_args2[4]:"base64",_context2.next=4,Util.loadImage(url);case 4:if(img=_context2.sent,canv=document.createElement("canvas"),canv.width=dw,canv.height=dh,ctx=canv.getContext("2d"),ctx.drawImage(img,0,0,dw,dh),"base64"!=ot){_context2.next=14;break}return _context2.abrupt("return",canv.toDataURL(type,.9));case 14:return _context2.abrupt("return",new Promise(function(resolve){canv.toBlob(function(blob){if("blob"==ot)resolve(blob);else if("blobUrl"==ot){var _url=URL.createObjectURL(blob);resolve(_url)}},type,.9)}));case 15:case"end":return _context2.stop()}},_callee2)}));return function(){return _ref2.apply(this,arguments)}}(),Util.isDataURI=function(src){return src&&0==src.indexOf("data:")},Util.generateUUID=function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()},Util.isMobile=function(){var check=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0)}(navigator.userAgent||navigator.vendor||window.opera),check},Util.isIOS=function(ua){return ua=ua||navigator.userAgent,/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},Util.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Util.cloneObject=function(obj){var out={};for(key in obj)out[key]=obj[key];return out},Util.hashCode=function(s){return s.split("").reduce(function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0)},Util.loadTrackSrc=function(context,src,callback,opt_progressCallback){var request=new XMLHttpRequest;request.open("GET",src,!0),request.responseType="arraybuffer",request.onload=function(){context.decodeAudioData(request.response,function(buffer){callback(buffer)},function(e){console.error(e)})},opt_progressCallback&&(request.onprogress=function(e){var percent=e.loaded/e.total;opt_progressCallback(percent)}),request.send()},Util.isPow2=function(n){return 0==(n&n-1)},Util.capitalize=function(s){return s.charAt(0).toUpperCase()+s.slice(1)},Util.isIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},Util.getQueryParameter=function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},Util.isWebGLEnabled=function(){var gl,canvas=document.createElement("canvas");try{gl=canvas.getContext("webgl")}catch(x){gl=null}if(null==gl)try{gl=canvas.getContext("experimental-webgl"),experimental=!0}catch(x){gl=null}return!!gl},Util.clone=function(obj){return JSON.parse(JSON.stringify(obj))},Util.hypot=Math.hypot||function(x,y){return Math.sqrt(x*x+y*y)},Util.isIE11=function(){return navigator.userAgent.match(/Trident/)},Util.isLandscapeMode=function(){return 90==window.orientation||-90==window.orientation},Util.getRectCenter=function(rect){return new THREE.Vector2(rect.x+rect.width/2,rect.y+rect.height/2)},Util.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},Util.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},Util.isIOS10OrLess=function(){if(!Util.isIOS())return!1;var re=/(iPhone|iPad|iPod) OS ([\d_]+)/,iOSVersion=navigator.userAgent.match(re);if(!iOSVersion)return!1;var versionString=iOSVersion[iOSVersion.length-1],majorVersion=parseFloat(versionString);return 10>=majorVersion},Util.isIOS9OrLess=function(){if(!Util.isIOS())return!1;var re=/(iPhone|iPad|iPod) OS ([\d_]+)/,iOSVersion=navigator.userAgent.match(re);if(!iOSVersion)return!1;var versionString=iOSVersion[iOSVersion.length-1],majorVersion=parseFloat(versionString);return 9>=majorVersion},Util.getExtension=function(url){return url.split(".").pop()},Util.createGetParams=function(params){var out="?";for(var k in params){var paramString=k+"="+params[k]+"&";out+=paramString}return out.substring(0,params.length-2),out},Util.sendParentMessage=function(message){window.parent&&parent.postMessage(message,"*")},Util.parseBoolean=function(value){return"false"==value||0==value?!1:"true"==value||1==value?!0:!!value},Util.relativeToAbsolutePath=function(base,relative){for(var stack=base.split("/"),parts=relative.split("/"),i=0;i<parts.length;i++)"."!=parts[i]&&(".."==parts[i]?stack.pop():stack.push(parts[i]));return stack.join("/")},Util.isPathAbsolute=function(path){return!/^(?:\/|[a-z]+:\/\/)/.test(path)},Util.isEmptyObject=function(obj){return 0==Object.getOwnPropertyNames(obj).length},Util.isDebug=function(){return Util.parseBoolean(Util.getQueryParameter("debug"))},Util.isWebview=function(name,ua){return ua=ua||navigator.userAgent,"xview"===name?"undefined"!=typeof window.XView:"wk"===name?!!ua.match(/supportjdshwk/i)||1==window._is_jdsh_wkwebview:!1},Util.isApp=function(name,ua){return ua=ua||navigator.userAgent,"wx"===name?/micromessenger/i.test(ua):"qq"===name?/qq\//i.test(ua):"weibo"===name?/weibo/i.test(ua):"jd"===name?/^jdapp/i.test(ua):"jdlittle"===name?/^jdltapp/i.test(ua):"mp"===name?navigator.userAgent.match(/micromessenger/i)&&navigator.userAgent.match(/miniprogram/i)||"miniprogram"===window.__wxjs_environment:!1},Util.getCurrentScript=function(){return document.currentScript||console.warn("This browser does not support document.currentScript. Trying fallback."),document.currentScript||document.scripts[document.scripts.length-1]},Util.isAndroid=function(ua){return ua=ua||navigator.userAgent,/android/i.test(ua)&&!Util.isIOS()},window.Util=Util,module.exports=Util},{"@babel/runtime/helpers/asyncToGenerator":1,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/regenerator":5}],28:[function(_dereq_,module){"use strict";function WorldRenderer(selector,options,vm){this.options=options,this.rvm=function(){return vm},this.init_(selector),this.id=selector+"-worldrenderer",this.selector=selector,this.inintRender(selector),this.panoramaRenderer=new PanoramaRenderer(this.scene,this.camera,options),this.hotspotRenderer=new HotspotManager(this.scene,this.camera),this.embedspotRenderer=new EmbedspotManager(this.scene,selector,this),this.reticleRenderer=new ReticleRenderer(this.camera)}var _interopRequireDefault=_dereq_("@babel/runtime/helpers/interopRequireDefault"),_typeof2=_interopRequireDefault(_dereq_("@babel/runtime/helpers/typeof")),EventEmitter=(_dereq_("./CSS2DRenderer"),_dereq_("eventemitter3")),Opanorama=_dereq_("./opanorama"),HotspotManager=_dereq_("./hotspot-manager"),EmbedspotManager=_dereq_("./embedspot-manager"),ReticleRenderer=_dereq_("./reticle-renderer"),PanoramaRenderer=_dereq_("./panorama-renderer"),TWEEN=_dereq_("tween.js"),Util=_dereq_("./util"),AUTOPAN_DURATION=3e3,AUTOPAN_ANGLE=.4,fov=75;WorldRenderer.prototype=new EventEmitter,WorldRenderer.prototype.inintRender=function(){var renderer=new THREE.WebGLRenderer({antialias:!0,preserveDrawingBuffer:!0,alpha:!0});renderer.sortObjects=!0,renderer.setClearColor(16777215,0),renderer.setClearAlpha(0),renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),renderer.setPixelRatio(this.options.dpr||window.devicePixelRatio),renderer.domElement.id=this.selector+"-canvas",renderer.domElement.classList.add("pano-canvas"),this.container.appendChild(renderer.domElement),this.renderer=renderer,this.CSS2DRender=new THREE.CSS2DRenderer;var containerdiv=document.createElement("div");containerdiv.id=this.selector+"-container",containerdiv.classList="jd-container",containerdiv.style.width="100%",containerdiv.style.height="100%",containerdiv.style.position="absolute",this.CSS2DRender.setSize(this.container.offsetWidth,this.container.offsetHeight),containerdiv.append(this.CSS2DRender.domElement),this.CSS2DRender.domElement.style.position="absolute",this.CSS2DRender.domElement.style.top=0,this.CSS2DRender.domElement.id=this.selector+"-renderer",this.container.appendChild(containerdiv)},WorldRenderer.prototype.render=function(time){this.controls&&this.controls.update(),this.panoramaRenderer&&this.panoramaRenderer.update(),TWEEN.update(time),this.renderer.render(this.scene,this.camera),this.CSS2DRender.render(this.scene,this.camera,this.hotspotRenderer.hostpotDatas),this.embedspotRenderer.update(this.camera)},WorldRenderer.prototype.setWordDeviceorientation=function(status){this.controls.setWordDeviceorientation(status)},WorldRenderer.prototype.setScene=function(scene,isInit){var _this=this,self=this,promise=new Promise(function(resolve,reject){self.sceneResolve=resolve,self.sceneReject=reject});if(!scene||!scene.isValid())return Promise.reject(new Error(""));({isStereo:scene.isStereo});if(this.setDefaultYaw_(scene.defaultYaw||0),scene.isVROff||scene.video&&Util.isIOS9OrLess(),this.sceneInfo=scene,this.controls)this.controls.autoRotationController(!1),this.controls.reset(this.sceneInfo.FixedLat||0,this.sceneInfo.FixedLon||.1);else{var controls=new Opanorama({camera:this.camera,offsetLongitude:this.sceneInfo.FixedLon||270,offsetLatitude:this.sceneInfo.FixedLat||0,radius:500,container:document.getElementById(this.selector+"-container"),selector:this.selector,horizontalLock:this.sceneInfo.horizontalLock,verticalLock:this.sceneInfo.verticalLock},this.rvm());this.controls=controls,controls.on("cruiseStart",function(){_this.emit("cruiseStart")},{}),controls.on("cruiseStop",function(){_this.emit("cruiseStop")},{}),controls.on("touchStart",function(e){_this.emit("touchStart",e)},{}),controls.on("touchMove",function(e){_this.emit("touchMove",e)},{}),controls.on("touchEnd",function(e){var embedRes=_this.embedspotRenderer.testEmbedEmbetSpot(e);_this.emit("touchEnd",e,embedRes?"embed":"")},{}),controls.on("compassUpdate",function(e){_this.emit("compassUpdate",e)},{})}if(scene.image&&!scene.video){var isPlayPlanet=this.sceneInfo.isPlayPlanet;this.panoramaRenderer.createPano(this.sceneInfo,isInit,isPlayPlanet).then(function(){_this.hotspotRenderer.addAllHost(_this.sceneInfo),_this.embedspotRenderer.addAllEmbed(_this.sceneInfo),self.render(),self.didLoad_()})["catch"](function(){})}return Util.isDebug()&&console.log("Loaded scene",scene),promise},WorldRenderer.prototype.northFix=function(){var photoGroup=this.scene.getObjectByName("photo"),hotspotGroup=this.scene.getObjectByName("hotspotRoot"),embedGroup=this.scene.getObjectByName("embedspotRoot"),northFix=this.sceneInfo.northFix||0;northFix=THREE.Math.degToRad(northFix);var euler=new THREE.Euler(0,northFix,0,"XYZ");photoGroup.setRotationFromEuler(euler),hotspotGroup.setRotationFromEuler(euler),embedGroup.setRotationFromEuler(euler)},WorldRenderer.prototype.isVRMode=function(){return!!this.vrDisplay&&this.vrDisplay.isPresenting},WorldRenderer.prototype.submitFrame=function(){this.isVRMode()&&this.vrDisplay.submitFrame()},WorldRenderer.prototype.destroy=function(){this.player&&(this.player.removeAllListeners(),this.player.destroy(),this.player=null)},WorldRenderer.prototype.didLoad_=function(opt_event){var event=opt_event||{};this.emit("load",event),this.sceneResolve&&this.sceneResolve()},WorldRenderer.prototype.didLoadFail_=function(message){this.emit("error",message)},WorldRenderer.prototype.setDefaultYaw_=function(angleRad){this.camera.parent.rotation.y=Math.PI/2+angleRad},WorldRenderer.prototype.autopan=function(){{var targetY=this.camera.parent.rotation.y-AUTOPAN_ANGLE;new TWEEN.Tween(this.camera.parent.rotation).to({y:targetY},AUTOPAN_DURATION).easing(TWEEN.Easing.Quadratic.Out).start()}},WorldRenderer.prototype.init_=function(selector){this.container=document.getElementById(selector)?document.getElementById(selector):document.body;var aspect=this.container.offsetWidth/this.container.offsetHeight;this.start_aspect=aspect;var camera=new THREE.PerspectiveCamera(this.options.fov||fov,aspect,.1,1e5);camera.layers.enable(1);var cameraDummy=new THREE.Object3D;cameraDummy.add(camera),this.start_width=this.container.offsetWidth,this.start_height=this.container.offsetHeight,this.camera=camera,this.scene=this.createScene_(),this.scene.add(this.camera.parent),this.hotspotInfo=[];var renderId=this.renderer&&this.renderer.id,cvs=document.getElementById(renderId);null!=cvs?window.addEventListener("resize",this.onResize_.bind(this)):(window.addEventListener("resize",this.onResize_.bind(this)),window.addEventListener("contextmenu",this.onContextMenu_.bind(this)),window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange_.bind(this)))},WorldRenderer.prototype.setFullScreen=function(status){var element=document.getElementById(this.selector+"-canvas").parentNode;status?this.launchFullscreen(element):this.exitFullscreen()},WorldRenderer.prototype.launchFullscreen=function(element){element.requestFullscreen?element.requestFullscreen():element.mozRequestFullScreen?element.mozRequestFullScreen():element.msRequestFullscreen?element.msRequestFullscreen():element.oRequestFullscreen?element.oRequestFullscreen():element.webkitRequestFullscreen&&element.webkitRequestFullScreen()},WorldRenderer.prototype.getFullScreenStatus=function(callback){var element=document.getElementById(this.selector+"-canvas").parentNode;element.requestFullscreen?element.addEventListener("fullscreenchange",function(){callback(null!=document.fullscreenElement?!0:!1)}):element.msRequestFullscreen&&element.addEventListener("MSFullscreenChange",function(){callback(null!=document.msFullscreenElement?!0:!1)})},WorldRenderer.prototype.setHotspotInfo=function(info){this.hotspotInfo.length=0,this.hotspotInfo=info,console.log(" this.hotspotInfo ",this.hotspotInfo.length)},WorldRenderer.prototype.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.oRequestFullscreen?document.oCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},WorldRenderer.prototype.invokeFieldOrMethod=function(element,method){var usablePrefixMethod;return["webkit","moz","ms","o",""].forEach(function(prefix){if(!usablePrefixMethod){""===prefix&&(method=method.slice(0,1).toLowerCase()+method.slice(1));var typePrefixMethod=_typeof2["default"](element[prefix+method]);typePrefixMethod+""!="undefined"&&(usablePrefixMethod="function"===typePrefixMethod?element[prefix+method]():element[prefix+method])}}),usablePrefixMethod},WorldRenderer.prototype.onResize_=function(){if(Util.isIOS()){var aspect=this.start_aspect,isWeiBo=!1;navigator.userAgent.indexOf("Weibo")>0&&(isWeiBo=!0),isWeiBo?(this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight):Util.isLandscapeMode()?(this.camera.aspect=screen.height/screen.width,this.renderer.setSize(screen.height,screen.width),console.log("isWeiBo !!!isLandscapeMode")):(this.renderer.setSize(this.start_width,this.start_height),this.camera.aspect=aspect)}else this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.CSS2DRender.setSize(this.container.offsetWidth,this.container.offsetHeight),this.camera.aspect=this.container.offsetWidth/this.container.offsetHeight;this.camera.updateProjectionMatrix()},WorldRenderer.prototype.onVRDisplayPresentChange_=function(){Util.isDebug()&&console.log("onVRDisplayPresentChange_");{var isVR=this.isVRMode();isVR&&this.hotspotRenderer.getCount()>0}this.onResize_(),window.analytics&&analytics.logModeChanged(isVR),!isVR&&Util.isIOS()&&Util.sendParentMessage({type:"exit-fullscreen"}),this.emit("modechange",isVR)},WorldRenderer.prototype.createScene_=function(){var scene=new THREE.Scene,photoGroup=new THREE.Object3D;return photoGroup.name="photo",scene.add(photoGroup),scene},WorldRenderer.prototype.onHotspotFocus_=function(){this.setCursor_("pointer")},WorldRenderer.prototype.onHotspotBlur_=function(){this.setCursor_("")},WorldRenderer.prototype.setCursor_=function(cursor){this.renderer.domElement.style.cursor=cursor},WorldRenderer.prototype.onContextMenu_=function(e){return e.preventDefault(),e.stopPropagation(),!1},WorldRenderer.prototype.lookAtHotspot=function(hotspotInfo){var pos=this.hotspotRenderer.getHotspotPos(hotspotInfo);this.controls.lookAtPosition(pos)},module.exports=WorldRenderer},{"./CSS2DRenderer":10,"./embedspot-manager":11,"./hotspot-manager":13,"./opanorama":17,"./panorama-renderer":22,"./reticle-renderer":24,"./util":27,"@babel/runtime/helpers/interopRequireDefault":2,"@babel/runtime/helpers/typeof":3,eventemitter3:7,"tween.js":9}]},{},[16])(16)});